import{l as Pe,p as gs,j as e,K as $e,m as le,q as Y,r as js,s as ze,u as Ve,N as fs,O as vs,c as ue,L as $,Q as se,W as Ge,B as A,X as je,Y as te,Z as ae,_ as ie,C as de,k,I as M,$ as Se,a0 as Z,a1 as re,a2 as Ee,a3 as Be,d as K,e as ce,g as oe,i as B,h as bs,a4 as De,a5 as Ie,a6 as ne,a7 as Ae,a8 as be,a9 as Ne,aa as ye,ab as we,ac as X,ad as ke,U as Ke,y as We,ae as Re,af as Te,ag as Ns,D as Me,ah as ys,x as ws,T as _s,S as Cs,z as Ss,H as Es}from"./ui-components-CWudljTY.js";import{r as i,d as ks}from"./vendor-Ko1KMr1j.js";import{a as He,A as H,b as J,d as Ts,c as Fs}from"./index-CBcScvnd.js";import{u as Oe,g as Ds,B as G,b as Is,c as As,d as qs,e as Je,C as ee,q as xe,a as Rs,f as _e,r as Ms,h as Ue,i as Os}from"./checkbox-BuUn4e2I.js";function Us(){const[s,r]=i.useState([]),[c,x]=i.useState(null),[C,f]=i.useState(!1),[N,p]=i.useState(null),T=i.useCallback(async()=>{try{f(!0),p(null);const j=await Oe.getStudents();r(j)}catch(j){console.error("âŒ Erreur lors de la rÃ©cupÃ©ration des Ã©tudiants:",j),p(j.message||"Erreur lors du chargement des Ã©tudiants")}finally{f(!1)}},[]),b=i.useCallback(async j=>{try{f(!0),p(null);const R=await Oe.getUserStatistics(j);console.log("ðŸ“Š Stats rÃ©cupÃ©rÃ©es pour userId",j,":",R),x(R)}catch(R){console.error("âŒ Erreur lors de la rÃ©cupÃ©ration des statistiques:",R),p(R.message||"Erreur lors du chargement des statistiques")}finally{f(!1)}},[]),o=i.useCallback(()=>{x(null)},[]);i.useEffect(()=>{T()},[T]);const u=s.filter(j=>j.is_active),y=s.filter(j=>!j.is_active);return{students:s,activeStudents:u,inactiveStudents:y,isLoading:C,error:N,selectedUserStats:c,fetchStudents:T,fetchUserStatistics:b,clearSelectedUser:o}}var Ce="rovingFocusGroup.onEntryFocus",Ls={bubbles:!1,cancelable:!0},me="RovingFocusGroup",[Fe,Ye,Qs]=gs(me),[Ps,Xe]=Pe(me,[Qs]),[$s,zs]=Ps(me),Ze=i.forwardRef((s,r)=>e.jsx(Fe.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(Fe.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(Vs,{...s,ref:r})})}));Ze.displayName=me;var Vs=i.forwardRef((s,r)=>{const{__scopeRovingFocusGroup:c,orientation:x,loop:C=!1,dir:f,currentTabStopId:N,defaultCurrentTabStopId:p,onCurrentTabStopIdChange:T,onEntryFocus:b,preventScrollOnEntryFocus:o=!1,...u}=s,y=i.useRef(null),j=js(r,y),R=ze(f),[m,g]=Ve({prop:N,defaultProp:p??null,onChange:T,caller:me}),[w,E]=i.useState(!1),h=fs(b),U=Ye(c),q=i.useRef(!1),[a,v]=i.useState(0);return i.useEffect(()=>{const I=y.current;if(I)return I.addEventListener(Ce,h),()=>I.removeEventListener(Ce,h)},[h]),e.jsx($s,{scope:c,orientation:x,dir:R,loop:C,currentTabStopId:m,onItemFocus:i.useCallback(I=>g(I),[g]),onItemShiftTab:i.useCallback(()=>E(!0),[]),onFocusableItemAdd:i.useCallback(()=>v(I=>I+1),[]),onFocusableItemRemove:i.useCallback(()=>v(I=>I-1),[]),children:e.jsx(le.div,{tabIndex:w||a===0?-1:0,"data-orientation":x,...u,ref:j,style:{outline:"none",...s.style},onMouseDown:Y(s.onMouseDown,()=>{q.current=!0}),onFocus:Y(s.onFocus,I=>{const V=!q.current;if(I.target===I.currentTarget&&V&&!w){const L=new CustomEvent(Ce,Ls);if(I.currentTarget.dispatchEvent(L),!L.defaultPrevented){const z=U().filter(O=>O.focusable),F=z.find(O=>O.active),d=z.find(O=>O.id===m),P=[F,d,...z].filter(Boolean).map(O=>O.ref.current);ts(P,o)}}q.current=!1}),onBlur:Y(s.onBlur,()=>E(!1))})})}),es="RovingFocusGroupItem",ss=i.forwardRef((s,r)=>{const{__scopeRovingFocusGroup:c,focusable:x=!0,active:C=!1,tabStopId:f,children:N,...p}=s,T=$e(),b=f||T,o=zs(es,c),u=o.currentTabStopId===b,y=Ye(c),{onFocusableItemAdd:j,onFocusableItemRemove:R,currentTabStopId:m}=o;return i.useEffect(()=>{if(x)return j(),()=>R()},[x,j,R]),e.jsx(Fe.ItemSlot,{scope:c,id:b,focusable:x,active:C,children:e.jsx(le.span,{tabIndex:u?0:-1,"data-orientation":o.orientation,...p,ref:r,onMouseDown:Y(s.onMouseDown,g=>{x?o.onItemFocus(b):g.preventDefault()}),onFocus:Y(s.onFocus,()=>o.onItemFocus(b)),onKeyDown:Y(s.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){o.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const w=Ks(g,o.orientation,o.dir);if(w!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let h=y().filter(U=>U.focusable).map(U=>U.ref.current);if(w==="last")h.reverse();else if(w==="prev"||w==="next"){w==="prev"&&h.reverse();const U=h.indexOf(g.currentTarget);h=o.loop?Ws(h,U+1):h.slice(U+1)}setTimeout(()=>ts(h))}}),children:typeof N=="function"?N({isCurrentTabStop:u,hasTabStop:m!=null}):N})})});ss.displayName=es;var Gs={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Bs(s,r){return r!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function Ks(s,r,c){const x=Bs(s.key,c);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(x))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(x)))return Gs[x]}function ts(s,r=!1){const c=document.activeElement;for(const x of s)if(x===c||(x.focus({preventScroll:r}),document.activeElement!==c))return}function Ws(s,r){return s.map((c,x)=>s[(r+x)%s.length])}var Hs=Ze,Js=ss,fe="Tabs",[Ys]=Pe(fe,[Xe]),as=Xe(),[Xs,qe]=Ys(fe),is=i.forwardRef((s,r)=>{const{__scopeTabs:c,value:x,onValueChange:C,defaultValue:f,orientation:N="horizontal",dir:p,activationMode:T="automatic",...b}=s,o=ze(p),[u,y]=Ve({prop:x,onChange:C,defaultProp:f??"",caller:fe});return e.jsx(Xs,{scope:c,baseId:$e(),value:u,onValueChange:y,orientation:N,dir:o,activationMode:T,children:e.jsx(le.div,{dir:o,"data-orientation":N,...b,ref:r})})});is.displayName=fe;var rs="TabsList",ns=i.forwardRef((s,r)=>{const{__scopeTabs:c,loop:x=!0,...C}=s,f=qe(rs,c),N=as(c);return e.jsx(Hs,{asChild:!0,...N,orientation:f.orientation,dir:f.dir,loop:x,children:e.jsx(le.div,{role:"tablist","aria-orientation":f.orientation,...C,ref:r})})});ns.displayName=rs;var ls="TabsTrigger",cs=i.forwardRef((s,r)=>{const{__scopeTabs:c,value:x,disabled:C=!1,...f}=s,N=qe(ls,c),p=as(c),T=us(N.baseId,x),b=ms(N.baseId,x),o=x===N.value;return e.jsx(Js,{asChild:!0,...p,focusable:!C,active:o,children:e.jsx(le.button,{type:"button",role:"tab","aria-selected":o,"aria-controls":b,"data-state":o?"active":"inactive","data-disabled":C?"":void 0,disabled:C,id:T,...f,ref:r,onMouseDown:Y(s.onMouseDown,u=>{!C&&u.button===0&&u.ctrlKey===!1?N.onValueChange(x):u.preventDefault()}),onKeyDown:Y(s.onKeyDown,u=>{[" ","Enter"].includes(u.key)&&N.onValueChange(x)}),onFocus:Y(s.onFocus,()=>{const u=N.activationMode!=="manual";!o&&!C&&u&&N.onValueChange(x)})})})});cs.displayName=ls;var os="TabsContent",ds=i.forwardRef((s,r)=>{const{__scopeTabs:c,value:x,forceMount:C,children:f,...N}=s,p=qe(os,c),T=us(p.baseId,x),b=ms(p.baseId,x),o=x===p.value,u=i.useRef(o);return i.useEffect(()=>{const y=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(y)},[]),e.jsx(vs,{present:C||o,children:({present:y})=>e.jsx(le.div,{"data-state":o?"active":"inactive","data-orientation":p.orientation,role:"tabpanel","aria-labelledby":T,hidden:!y,id:b,tabIndex:0,...N,ref:r,style:{...s.style,animationDuration:u.current?"0s":void 0},children:y&&f})})});ds.displayName=os;function us(s,r){return`${s}-trigger-${r}`}function ms(s,r){return`${s}-content-${r}`}var Zs=is,et=ns,st=cs,tt=ds;function at({className:s,...r}){return e.jsx(Zs,{"data-slot":"tabs",className:ue("flex flex-col gap-2",s),...r})}function it({className:s,...r}){return e.jsx(et,{"data-slot":"tabs-list",className:ue("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",s),...r})}function he({className:s,...r}){return e.jsx(st,{"data-slot":"tabs-trigger",className:ue("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}function pe({className:s,...r}){return e.jsx(tt,{"data-slot":"tabs-content",className:ue("flex-1 outline-none",s),...r})}function ge({className:s,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:ue("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r})}const rt=async s=>{const r=new FormData;return r.append("image",s),(await He.post("/themes/upload-image",r,{headers:{"Content-Type":"multipart/form-data"}})).data.data},nt=async s=>{const r=new FormData;return r.append("image",s),(await He.post("/questions/upload-image",r,{headers:{"Content-Type":"multipart/form-data"}})).data.data};function lt(){const[s,r]=i.useState([]),[c,x]=i.useState(!0),[C,f]=i.useState(!1),[N,p]=i.useState(!1),[T,b]=i.useState(null),[o,u]=i.useState(!1),[y,j]=i.useState(null),[R,m]=i.useState(null),[g,w]=i.useState(!1),[E,h]=i.useState(null),[U,q]=i.useState(null),[a,v]=i.useState({title:"",description:"",icon:"",color:"",display_order:0});i.useEffect(()=>{I()},[]);const I=async()=>{try{x(!0);const n=await Ds();r(n)}catch{j("Erreur lors du chargement des thÃ¨mes")}finally{x(!1)}},V=async n=>{if(n.preventDefault(),j(null),m(null),!a.title.trim()){j("Le titre est requis");return}try{u(!0),T?(await Is(T.id,a),m(`ThÃ¨me "${a.title}" modifiÃ© avec succÃ¨s`),p(!1)):(await As(a),m(`ThÃ¨me "${a.title}" crÃ©Ã© avec succÃ¨s`),f(!1)),F(),I(),setTimeout(()=>m(null),5e3)}catch(_){j(_.response?.data?.message||"Erreur lors de l'enregistrement")}finally{u(!1)}},L=n=>{b(n),v({title:n.title,description:n.description||"",icon:n.icon||"",color:n.color||"",display_order:n.display_order||0}),q(n.icon||null),p(!0)},z=async n=>{if(confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le thÃ¨me "${n.title}" ? Toutes les questions associÃ©es seront Ã©galement supprimÃ©es.`))try{await qs(n.id),m(`ThÃ¨me "${n.title}" supprimÃ© avec succÃ¨s`),I(),setTimeout(()=>m(null),5e3)}catch(_){j(_.response?.data?.message||"Erreur lors de la suppression")}},F=()=>{v({title:"",description:"",icon:"",color:"",display_order:0}),b(null),h(null),q(null)},d=()=>{F(),j(null),f(!1),p(!1)},Q=n=>{const _=n.target.files?.[0];if(_){h(_);const W=new FileReader;W.onloadend=()=>{q(W.result)},W.readAsDataURL(_)}},P=()=>{h(null),q(null),v(n=>({...n,icon:""}))},O=async()=>{if(E)try{w(!0);const n=await rt(E);v(_=>({..._,icon:n.imageUrl})),m("Image uploadÃ©e avec succÃ¨s"),setTimeout(()=>m(null),3e3)}catch(n){j(n.message||"Erreur lors de l'upload de l'image")}finally{w(!1)}};return c?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gestion des thÃ¨mes"}),e.jsx("p",{className:"text-slate-600",children:"CrÃ©er et gÃ©rer les thÃ¨mes de quiz"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs(se,{open:C,onOpenChange:f,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(A,{onClick:F,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Nouveau thÃ¨me"]})}),e.jsxs(te,{className:"sm:max-w-lg","aria-describedby":void 0,children:[e.jsx(ae,{children:e.jsx(ie,{children:"CrÃ©er un nouveau thÃ¨me"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[y&&e.jsxs(H,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(J,{children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"title",children:"Nom du thÃ¨me *"}),e.jsx(M,{id:"title",type:"text",placeholder:"Ex: Navigation maritime",value:a.title,onChange:n=>v(_=>({..._,title:n.target.value})),disabled:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"description",children:"Description"}),e.jsx(ge,{id:"description",placeholder:"Description du thÃ¨me...",value:a.description,onChange:n=>v(_=>({..._,description:n.target.value})),disabled:o,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Image du thÃ¨me (optionnel)"}),U||a.icon?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative w-full max-w-xs mx-auto h-32 border-2 border-dashed border-slate-300 rounded-lg overflow-hidden",children:[e.jsx("img",{src:U||a.icon,alt:"AperÃ§u",className:"w-full h-full object-contain bg-slate-50"}),e.jsx("button",{type:"button",onClick:P,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(Se,{className:"w-4 h-4"})})]}),E&&!a.icon&&e.jsx(A,{type:"button",onClick:O,disabled:g,size:"sm",className:"w-full",children:g?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Uploader l'image"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-slate-500",children:"Ou"})})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"icon-url",children:"Modifier l'URL d'image"}),e.jsx(M,{id:"icon-url",type:"url",placeholder:"https://exemple.com/image.jpg",value:a.icon||"",onChange:n=>{const _=n.target.value;v(W=>({...W,icon:_})),q(_||null)}})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Glissez une image ou cliquez pour sÃ©lectionner"}),e.jsx(M,{type:"file",accept:"image/*",onChange:Q,disabled:o,className:"cursor-pointer"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-slate-500",children:"Ou"})})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"icon-url",children:"Entrez une URL d'image"}),e.jsx(M,{id:"icon-url",type:"url",placeholder:"https://exemple.com/image.jpg",value:a.icon||"",onChange:n=>{const _=n.target.value;v(W=>({...W,icon:_})),_&&q(_)}})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Formats acceptÃ©s: JPEG, PNG, GIF, WebP (max 5MB)"})]}),e.jsxs(re,{className:"gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:d,disabled:o,children:"Annuler"}),e.jsx(A,{type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"CrÃ©ation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"CrÃ©er le thÃ¨me"]})})]})]})]})]})})]}),R&&e.jsxs(H,{className:"border-green-200 bg-green-50 text-green-800",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(J,{children:R})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.isArray(s)&&s.map(n=>e.jsxs(K,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ce,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[n.icon?e.jsx("div",{className:"w-10 h-10 rounded-lg overflow-hidden border border-slate-200",children:e.jsx("img",{src:n.icon,alt:n.title,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(oe,{className:"text-base",children:n.title}),n.question_count!==void 0&&e.jsxs(G,{variant:"outline",className:"mt-1 text-xs",children:[n.question_count," questions"]})]})]})})}),e.jsxs(B,{className:"space-y-3",children:[e.jsx(bs,{className:"text-sm",children:n.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>L(n),className:"flex-1",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Modifier"]}),e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>z(n),className:"flex-1",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Supprimer"]})]})]})]},n.id))}),e.jsx(se,{open:N,onOpenChange:p,children:e.jsxs(te,{className:"sm:max-w-lg","aria-describedby":void 0,children:[e.jsx(ae,{children:e.jsx(ie,{children:"Modifier le thÃ¨me"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[y&&e.jsxs(H,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(J,{children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"edit-title",children:"Titre *"}),e.jsx(M,{id:"edit-title",type:"text",value:a.title,onChange:n=>v(_=>({..._,title:n.target.value})),disabled:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"edit-description",children:"Description"}),e.jsx(ge,{id:"edit-description",value:a.description,onChange:n=>v(_=>({..._,description:n.target.value})),disabled:o,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Image du thÃ¨me (optionnel)"}),U||a.icon?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative w-full max-w-xs mx-auto h-32 border-2 border-dashed border-slate-300 rounded-lg overflow-hidden",children:[e.jsx("img",{src:U||a.icon,alt:"AperÃ§u",className:"w-full h-full object-contain bg-slate-50"}),e.jsx("button",{type:"button",onClick:P,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(Se,{className:"w-4 h-4"})})]}),E&&!a.icon&&e.jsx(A,{type:"button",onClick:O,disabled:g,size:"sm",className:"w-full",children:g?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Uploader l'image"]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Glissez une image ou cliquez pour sÃ©lectionner"}),e.jsx(M,{type:"file",accept:"image/*",onChange:Q,disabled:o,className:"cursor-pointer"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Formats acceptÃ©s: JPEG, PNG, GIF, WebP (max 5MB)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"edit-icon-url",children:"Ou entrez une URL d'image"}),e.jsx(M,{id:"edit-icon-url",type:"text",placeholder:"https://...",value:a.icon||"",onChange:n=>v(_=>({..._,icon:n.target.value})),disabled:o||!!E})]}),e.jsxs(re,{className:"gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:d,disabled:o,children:"Annuler"}),e.jsx(A,{type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Modification..."]}):"Enregistrer"})]})]})]})})]})}function ct(s){let r=`${s.question_text}. `;return s.question_type==="multiple_choice"&&(s.option_a&&(r+=`Option A : ${s.option_a}. `),s.option_b&&(r+=`Option B : ${s.option_b}. `),s.option_c&&(r+=`Option C : ${s.option_c}. `),s.option_d&&(r+=`Option D : ${s.option_d}. `)),r.trim()}async function Le(s,r){try{console.log(`ðŸŽ™ï¸ [Question ${s}] GÃ©nÃ©ration de la voix en cours...`);const c="https://libertyloc-backend-production-2615.up.railway.app/api",x=ct(r),C=await ks.post(`${c}/admin/generate-speech`,{question_id:s,text:x},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!C.data.success)throw new Error(C.data.error||"Erreur lors de la gÃ©nÃ©ration");const{fileName:f,filePath:N}=C.data;return console.log(`âœ… [Question ${s}] Fichier gÃ©nÃ©rÃ© : ${f}`),console.log(`âœ… [Question ${s}] BD mise Ã  jour automatiquement`),console.log(`ðŸŽ‰ [Question ${s}] Voix gÃ©nÃ©rÃ©e avec succÃ¨s !`),{success:!0,filename:f,audioUrl:N}}catch(c){throw console.error(`âŒ [Question ${s}] Erreur gÃ©nÃ©ration voix:`,c),c}}function ot(){const[s,r]=i.useState([]),[c,x]=i.useState(!0),[C,f]=i.useState(null),[N,p]=i.useState(null),[T,b]=i.useState(null),[o,u]=i.useState(!1),[y,j]=i.useState(null),[R,m]=i.useState(!1),[g,w]=i.useState(!1),[E,h]=i.useState(null),[U,q]=i.useState(null),[a,v]=i.useState({theme_id:0,question_text:"",question_type:"multiple_choice",option_a:"",option_b:"",option_c:"",option_d:"",correct_answer:"",explanation:"",difficulty:"medium",image_url:""});i.useEffect(()=>{I()},[]);const I=async()=>{try{x(!0),p(null);const t=await Je();r(t)}catch(t){console.error("Erreur chargement thÃ¨mes:",t),p("Erreur lors du chargement des thÃ¨mes"),r([])}finally{x(!1)}},V=async t=>{try{p(null);const l=await xe.getByTheme(t);r(D=>D.map(S=>S.id===t?{...S,questions:l,question_count:l.length}:S))}catch(l){console.error("Erreur rechargement questions:",l),p("Erreur lors du rechargement des questions")}},L=t=>{f(C===t?null:t)},z=(t,l)=>{t?(j(t),v({theme_id:t.theme_id,question_text:t.question_text,question_type:t.question_type,option_a:t.option_a||"",option_b:t.option_b||"",option_c:t.option_c||"",option_d:t.option_d||"",correct_answer:t.correct_answer||"",explanation:t.explanation||"",difficulty:t.difficulty||"medium",image_url:t.image_url||""}),h(null),q(t.image_url||null)):(j(null),v({theme_id:l||0,question_text:"",question_type:"multiple_choice",option_a:"",option_b:"",option_c:"",option_d:"",correct_answer:"",explanation:"",difficulty:"medium",image_url:""}),h(null),q(null)),u(!0)},F=()=>{u(!1),j(null),p(null),h(null),q(null)},d=t=>{const l=t.target.files?.[0];if(l){h(l);const D=new FileReader;D.onloadend=()=>{q(D.result)},D.readAsDataURL(l)}},Q=()=>{h(null),q(null),v(t=>({...t,image_url:""}))},P=async()=>{if(E)try{w(!0);const t=await nt(E);v(l=>({...l,image_url:t.imageUrl})),b("Image uploadÃ©e avec succÃ¨s"),setTimeout(()=>b(null),3e3)}catch(t){p(t.message||"Erreur lors de l'upload de l'image")}finally{w(!1)}},O=t=>{const l=a.correct_answer.split(",").filter(D=>D);if(l.includes(t)){const D=l.filter(S=>S!==t);v({...a,correct_answer:D.join(",")})}else{const D=[...l,t].sort();v({...a,correct_answer:D.join(",")})}},n=t=>a.correct_answer.split(",").includes(t),_=async()=>{try{if(m(!0),p(null),!a.question_text.trim()){p("Le texte de la question est requis");return}if(a.question_type==="multiple_choice"){if(!a.option_a.trim()||!a.option_b.trim()){p("Au moins 2 options sont requises pour un QCM");return}if(!a.correct_answer){p("Veuillez sÃ©lectionner au moins une rÃ©ponse correcte");return}}else if(!["true","false","A","B"].includes(a.correct_answer)){p('La rÃ©ponse correcte doit Ãªtre "true" ou "false" (ou A/B)');return}if(y){const t=await xe.update(y.id,a);if(b("Question modifiÃ©e avec succÃ¨s"),t.voiceNeedsRegeneration){console.log(`ðŸ”„ RÃ©gÃ©nÃ©ration de la voix pour la question ${y.id}...`);try{await Le(y.id,{question_text:a.question_text,question_type:a.question_type,option_a:a.option_a,option_b:a.option_b,option_c:a.option_c,option_d:a.option_d}),b("Question modifiÃ©e et voix rÃ©gÃ©nÃ©rÃ©e avec succÃ¨s")}catch(l){console.error("Erreur gÃ©nÃ©ration voix:",l),b("Question modifiÃ©e (erreur gÃ©nÃ©ration voix)")}}}else{const l=(await xe.create(a)).id;b("Question crÃ©Ã©e avec succÃ¨s"),console.log(`ðŸŽ™ï¸ GÃ©nÃ©ration de la voix pour la nouvelle question ${l}...`);try{await Le(l,{question_text:a.question_text,question_type:a.question_type,option_a:a.option_a,option_b:a.option_b,option_c:a.option_c,option_d:a.option_d}),b("Question crÃ©Ã©e et voix gÃ©nÃ©rÃ©e avec succÃ¨s")}catch(D){console.error("Erreur gÃ©nÃ©ration voix:",D),b("Question crÃ©Ã©e (erreur gÃ©nÃ©ration voix)")}}F(),a.theme_id&&await V(a.theme_id),setTimeout(()=>b(null),3e3)}catch(t){console.error("Erreur sauvegarde question:",t),p(t.response?.data?.message||"Erreur lors de la sauvegarde")}finally{m(!1)}},W=async(t,l)=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette question ?"))try{await xe.delete(t),b("Question supprimÃ©e avec succÃ¨s"),await V(l),setTimeout(()=>b(null),3e3)}catch(D){console.error("Erreur suppression question:",D),p(D.response?.data?.message||"Erreur lors de la suppression")}};return c?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des questions"})}),T&&e.jsx(H,{className:"bg-green-50 border-green-200",children:e.jsx(J,{className:"text-green-800",children:T})}),N&&e.jsx(H,{className:"bg-red-50 border-red-200",children:e.jsx(J,{className:"text-red-800",children:N})}),e.jsxs("div",{className:"grid gap-4",children:[Array.isArray(s)&&s.map(t=>{const l=C===t.id,D=t.questions||[];return e.jsxs(K,{children:[e.jsx(ce,{className:"cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>L(t.id),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"mt-1",children:l?e.jsx(ne,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ae,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(oe,{children:t.title}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["ðŸ“ ",D.length," questions"]}),t.description&&e.jsx("span",{className:"text-gray-500",children:t.description})]})]})]}),e.jsx("div",{className:"flex gap-2",onClick:S=>S.stopPropagation(),children:e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>z(void 0,t.id),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Ajouter une question"]})})]})}),l&&e.jsx(B,{className:"pt-0",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-sm text-gray-700",children:["Questions du thÃ¨me (",D.length,")"]}),D.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:D.map(S=>e.jsx(K,{className:"bg-gray-50 border border-gray-200",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[S.image_url&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:S.image_url,alt:"Question",className:"w-20 h-20 object-cover rounded border border-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:S.question_text}),e.jsxs("div",{className:"flex gap-2 flex-wrap mb-3",children:[e.jsx(G,{variant:S.question_type==="multiple_choice"?"default":"secondary",children:S.question_type==="multiple_choice"?"QCM":"Vrai/Faux"}),e.jsx(G,{variant:"outline",children:S.difficulty==="easy"?"ðŸ˜Š Facile":S.difficulty==="hard"?"ðŸ˜° Difficile":"ðŸ˜ Moyen"}),e.jsxs(G,{variant:"outline",className:"bg-green-50",children:["âœ“ RÃ©ponse: ",S.correct_answer]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[S.option_a&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{variant:S.correct_answer?.includes("A")?"default":"outline",className:"min-w-[24px] justify-center",children:"A"}),e.jsx("span",{children:S.option_a})]}),S.option_b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{variant:S.correct_answer?.includes("B")?"default":"outline",className:"min-w-[24px] justify-center",children:"B"}),e.jsx("span",{children:S.option_b})]}),S.option_c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{variant:S.correct_answer?.includes("C")?"default":"outline",className:"min-w-[24px] justify-center",children:"C"}),e.jsx("span",{children:S.option_c})]}),S.option_d&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{variant:S.correct_answer?.includes("D")?"default":"outline",className:"min-w-[24px] justify-center",children:"D"}),e.jsx("span",{children:S.option_d})]})]}),S.explanation&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:e.jsxs("p",{className:"text-xs text-blue-900",children:[e.jsx("strong",{children:"ðŸ’¡ Explication :"})," ",S.explanation]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>z(S),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>W(S.id,t.id),children:e.jsx(Ie,{className:"w-4 h-4"})})]})]})})},S.id))}):e.jsx("p",{className:"text-sm text-gray-500 italic py-4",children:'Aucune question pour ce thÃ¨me. Cliquez sur "Ajouter une question" pour commencer.'})]})})]},t.id)}),(!s||s.length===0)&&e.jsx(K,{children:e.jsx(B,{className:"p-8 text-center text-gray-500",children:`Aucun thÃ¨me crÃ©Ã©. Veuillez d'abord crÃ©er des thÃ¨mes dans "Gestion des thÃ¨mes".`})})]}),e.jsx(se,{open:o,onOpenChange:u,children:e.jsxs(te,{className:"max-w-3xl max-h-[90vh] overflow-y-auto","aria-describedby":void 0,children:[e.jsx(ae,{children:e.jsx(ie,{children:y?"Modifier la question":"Nouvelle question"})}),e.jsxs("div",{className:"space-y-4",children:[N&&e.jsx(H,{className:"bg-red-50 border-red-200",children:e.jsx(J,{className:"text-red-800",children:N})}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"question_text",children:"Question *"}),e.jsx(ge,{id:"question_text",value:a.question_text,onChange:t=>v({...a,question_text:t.target.value}),placeholder:"Ex: Quelle est la couleur du feu tribord ?",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"question_type",children:"Type de question"}),e.jsxs(be,{value:a.question_type,onValueChange:t=>v({...a,question_type:t}),children:[e.jsx(Ne,{children:e.jsx(ye,{})}),e.jsxs(we,{children:[e.jsx(X,{value:"multiple_choice",children:"QCM (4 options)"}),e.jsx(X,{value:"true_false",children:"Vrai/Faux"})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"difficulty",children:"DifficultÃ©"}),e.jsxs(be,{value:a.difficulty,onValueChange:t=>v({...a,difficulty:t}),children:[e.jsx(Ne,{children:e.jsx(ye,{})}),e.jsxs(we,{children:[e.jsx(X,{value:"easy",children:"ðŸ˜Š Facile"}),e.jsx(X,{value:"medium",children:"ðŸ˜ Moyen"}),e.jsx(X,{value:"hard",children:"ðŸ˜° Difficile"})]})]})]})]}),a.question_type==="multiple_choice"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{children:"Options et rÃ©ponses correctes *"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cochez les cases pour indiquer les bonnes rÃ©ponses"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx(ee,{id:"correct_a",checked:n("A"),onCheckedChange:()=>O("A"),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(k,{htmlFor:"option_a",className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{variant:"outline",children:"A"}),e.jsx("span",{className:"text-sm",children:"Option A *"})]}),e.jsx(M,{id:"option_a",value:a.option_a,onChange:t=>v({...a,option_a:t.target.value}),placeholder:"PremiÃ¨re option",required:!0})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx(ee,{id:"correct_b",checked:n("B"),onCheckedChange:()=>O("B"),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(k,{htmlFor:"option_b",className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{variant:"outline",children:"B"}),e.jsx("span",{className:"text-sm",children:"Option B *"})]}),e.jsx(M,{id:"option_b",value:a.option_b,onChange:t=>v({...a,option_b:t.target.value}),placeholder:"DeuxiÃ¨me option",required:!0})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx(ee,{id:"correct_c",checked:n("C"),onCheckedChange:()=>O("C"),disabled:!a.option_c,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(k,{htmlFor:"option_c",className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{variant:"outline",children:"C"}),e.jsx("span",{className:"text-sm",children:"Option C"})]}),e.jsx(M,{id:"option_c",value:a.option_c,onChange:t=>v({...a,option_c:t.target.value}),placeholder:"TroisiÃ¨me option (optionnel)"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx(ee,{id:"correct_d",checked:n("D"),onCheckedChange:()=>O("D"),disabled:!a.option_d,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(k,{htmlFor:"option_d",className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{variant:"outline",children:"D"}),e.jsx("span",{className:"text-sm",children:"Option D"})]}),e.jsx(M,{id:"option_d",value:a.option_d,onChange:t=>v({...a,option_d:t.target.value}),placeholder:"QuatriÃ¨me option (optionnel)"})]})]})]}),a.correct_answer&&e.jsx("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded",children:e.jsxs("p",{className:"text-sm text-green-800",children:["âœ“ RÃ©ponse(s) correcte(s) : ",e.jsx("strong",{children:a.correct_answer})]})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"option_a",children:"Option Vrai"}),e.jsx(M,{id:"option_a",value:a.option_a||"Vrai",onChange:t=>v({...a,option_a:t.target.value}),placeholder:"Vrai"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"option_b",children:"Option Faux"}),e.jsx(M,{id:"option_b",value:a.option_b||"Faux",onChange:t=>v({...a,option_b:t.target.value}),placeholder:"Faux"})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"correct_answer",children:"RÃ©ponse correcte *"}),e.jsxs(be,{value:a.correct_answer,onValueChange:t=>v({...a,correct_answer:t}),children:[e.jsx(Ne,{children:e.jsx(ye,{placeholder:"Choisir la bonne rÃ©ponse..."})}),e.jsxs(we,{children:[e.jsx(X,{value:"A",children:"Vrai (A)"}),e.jsx(X,{value:"B",children:"Faux (B)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"explanation",children:"Explication (optionnel)"}),e.jsx(ge,{id:"explanation",value:a.explanation,onChange:t=>v({...a,explanation:t.target.value}),placeholder:"Expliquez pourquoi cette rÃ©ponse est correcte...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Image de la question (optionnel)"}),U||a.image_url?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative w-full max-w-md mx-auto h-48 border-2 border-dashed border-slate-300 rounded-lg overflow-hidden",children:[e.jsx("img",{src:U||a.image_url,alt:"AperÃ§u de la question",className:"w-full h-full object-contain bg-slate-50"}),e.jsx("button",{type:"button",onClick:Q,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(Se,{className:"w-4 h-4"})})]}),E&&!a.image_url&&e.jsx(A,{type:"button",onClick:P,disabled:g,size:"sm",className:"w-full",children:g?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Uploader l'image"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-slate-500",children:"Ou"})})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"image-url",children:"Modifier l'URL d'image"}),e.jsx(M,{id:"image-url",type:"url",placeholder:"https://exemple.com/image.jpg",value:a.image_url,onChange:t=>{const l=t.target.value;v({...a,image_url:l}),q(l||null)}})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Glissez une image ou cliquez pour sÃ©lectionner"}),e.jsx(M,{id:"question-image",type:"file",accept:"image/*",onChange:d,disabled:R,className:"cursor-pointer"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-slate-500",children:"Ou"})})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"image-url",children:"Entrez une URL d'image"}),e.jsx(M,{id:"image-url",type:"url",placeholder:"https://exemple.com/image.jpg",value:a.image_url,onChange:t=>{const l=t.target.value;v({...a,image_url:l}),l&&q(l)}})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Formats acceptÃ©s: JPEG, PNG, GIF, WebP (max 5MB)"})]})]}),e.jsxs(re,{children:[e.jsx(A,{variant:"outline",onClick:F,children:"Annuler"}),e.jsx(A,{onClick:_,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2 animate-spin"}),"Enregistrement..."]}):"Enregistrer"})]})]})})]})}function dt({selectedQuestionIds:s,onSelectionChange:r}){const[c,x]=i.useState([]),[C,f]=i.useState(!0),[N,p]=i.useState(null),[T,b]=i.useState(new Set);i.useEffect(()=>{o()},[]);const o=async()=>{try{f(!0),p(null);const m=await Je();x(m);const g=new Set;m.forEach(w=>{w.questions.some(E=>s.includes(E.id))&&g.add(w.id)}),b(g)}catch(m){console.error("Erreur lors du chargement des thÃ¨mes:",m),p("Impossible de charger les questions")}finally{f(!1)}},u=m=>{b(g=>{const w=new Set(g);return w.has(m)?w.delete(m):w.add(m),w})},y=(m,g)=>{r(g?[...s,m]:s.filter(w=>w!==m))},j=(m,g)=>{const w=c.find(h=>h.id===m);if(!w)return;const E=w.questions.map(h=>h.id);if(g){const h=[...new Set([...s,...E])];r(h)}else r(s.filter(h=>!E.includes(h)))},R=m=>{const g=c.find(E=>E.id===m);if(!g||g.questions.length===0)return"none";const w=g.questions.filter(E=>s.includes(E.id)).length;return w===0?"none":w===g.questions.length?"all":"some"};return C?e.jsx(K,{children:e.jsxs(B,{className:"p-8 flex items-center justify-center",children:[e.jsx($,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),e.jsx("span",{children:"Chargement des questions..."})]})}):N?e.jsx(K,{children:e.jsx(B,{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:N})})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(k,{className:"text-base font-semibold",children:"SÃ©lection des questions"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.length," question",s.length!==1?"s":""," sÃ©lectionnÃ©e",s.length!==1?"s":""]})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto border rounded-lg p-2",children:[c.map(m=>{const g=T.has(m.id),w=R(m.id),E=m.questions.length>0;return e.jsxs(K,{className:"border-l-4",style:{borderLeftColor:m.color||"#3b82f6"},children:[e.jsx(ce,{className:"p-3 cursor-pointer hover:bg-gray-50",onClick:()=>E&&u(m.id),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[E?g?e.jsx(ne,{className:"w-4 h-4 text-gray-500"}):e.jsx(Ae,{className:"w-4 h-4 text-gray-500"}):e.jsx("div",{className:"w-4 h-4"}),E&&e.jsx(ee,{id:`theme-${m.id}`,checked:w==="all",onCheckedChange:h=>j(m.id,h),onClick:h=>h.stopPropagation(),className:w==="some"?"data-[state=checked]:bg-blue-400":""}),e.jsxs(oe,{className:"text-sm font-medium",children:[m.title,e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",m.questions.length," question",m.questions.length!==1?"s":"",")"]})]})]})})}),g&&E&&e.jsx(B,{className:"p-3 pt-0 space-y-2",children:m.questions.map(h=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded hover:bg-gray-50 border border-gray-200",children:[e.jsx(ee,{id:`question-${h.id}`,checked:s.includes(h.id),onCheckedChange:U=>y(h.id,U)}),e.jsxs(k,{htmlFor:`question-${h.id}`,className:"text-sm flex-1 cursor-pointer leading-relaxed",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Q",h.id,":"]})," ",h.question_text,h.difficulty&&e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${h.difficulty==="easy"?"bg-green-100 text-green-700":h.difficulty==="medium"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:h.difficulty==="easy"?"Facile":h.difficulty==="medium"?"Moyen":"Difficile"})]})]},h.id))}),!E&&e.jsx(B,{className:"p-3 pt-0",children:e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Aucune question disponible pour ce thÃ¨me"})})]},m.id)}),c.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Aucun thÃ¨me disponible"})]})]})}function ut(){const{exams:s,isLoading:r,error:c,createExam:x,updateExam:C,deleteExam:f}=Rs();console.log("ðŸ“Š MockExamManagement - exams:",s,"isArray:",Array.isArray(s));const[N,p]=i.useState(!1),[T,b]=i.useState(null),[o,u]=i.useState(!1),[y,j]=i.useState([]),[R,m]=i.useState(!1),[g,w]=i.useState(null),[E,h]=i.useState({}),[U,q]=i.useState(null),[a,v]=i.useState({title:"",duration_minutes:45,passing_score:80}),I=async d=>{if(p(!0),d){b(d),v({title:d.title,duration_minutes:d.duration_minutes,passing_score:d.passing_score}),m(!0);try{const P=(await _e(d.id)).questions.map(O=>O.id);j(P)}catch(Q){console.error("Erreur lors du chargement des questions:",Q),j([])}finally{m(!1)}}else b(null),v({title:"",duration_minutes:45,passing_score:80}),j([])},V=()=>{p(!1),b(null),v({title:"",duration_minutes:45,passing_score:80}),j([])},L=async()=>{try{u(!0);let d;if(T){await C(T.id,a),d=T.id;const P=(await _e(d)).questions.map(_=>_.id),O=P.filter(_=>!y.includes(_));O.length>0&&await Ms(d,O);const n=y.filter(_=>!P.includes(_));n.length>0&&await Ue({mock_exam_id:d,question_ids:n})}else d=(await x(a)).id,y.length>0&&await Ue({mock_exam_id:d,question_ids:y});V()}catch(d){console.error("Erreur lors de la sauvegarde:",d),alert("Erreur lors de la sauvegarde de l'examen. Veuillez rÃ©essayer.")}finally{u(!1)}},z=async d=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet examen blanc ?"))try{await f(d)}catch(Q){console.error("Erreur lors de la suppression:",Q)}},F=async d=>{if(g===d){w(null);return}if(w(d),!E[d]){q(d);try{const Q=await _e(d);h(P=>({...P,[d]:Q.questions}))}catch(Q){console.error("Erreur lors du chargement des questions:",Q)}finally{q(null)}}};return r?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx($,{className:"w-8 h-8 animate-spin text-blue-500 dark:text-blue-400"})}):c?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-600",children:["Erreur: ",c]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des examens blancs"}),e.jsxs(A,{onClick:()=>I(),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Nouvel examen"]})]}),e.jsxs("div",{className:"grid gap-4",children:[Array.isArray(s)&&s.map(d=>{const Q=g===d.id,P=E[d.id]||[],O=U===d.id;return e.jsxs(K,{children:[e.jsx(ce,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",onClick:()=>F(d.id),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"mt-1",children:Q?e.jsx(ne,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}):e.jsx(Ae,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(oe,{children:d.title}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["â±ï¸ ",d.duration_minutes," minutes"]}),e.jsxs("span",{children:["âœ… Note minimale: ",d.passing_score,"%"]}),e.jsxs("span",{children:["ðŸ“ ",d.question_count||0," questions"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",onClick:n=>n.stopPropagation(),children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>I(d),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>z(d.id),children:e.jsx(Ie,{className:"w-4 h-4"})})]})]})}),Q&&e.jsx(B,{className:"pt-0",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-sm text-gray-700 dark:text-gray-300",children:["Questions de l'examen (",P.length,")"]}),O?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx($,{className:"w-6 h-6 animate-spin text-blue-500 dark:text-blue-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Chargement des questions..."})]}):P.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:P.map((n,_)=>e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-slate-800 rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-semibold text-blue-500 dark:text-blue-400 text-sm min-w-[2rem]",children:["Q",_+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-200 mb-2",children:n.question_text}),e.jsxs("div",{className:"flex gap-3 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:n.theme_name}),n.difficulty&&e.jsx("span",{className:`px-2 py-1 rounded ${n.difficulty==="easy"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":n.difficulty==="medium"?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"}`,children:n.difficulty==="easy"?"Facile":n.difficulty==="medium"?"Moyen":"Difficile"}),e.jsx("span",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded",children:n.question_type==="multiple_choice"?"QCM":"Vrai/Faux"})]})]})]})},n.id))}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic py-4",children:"Aucune question associÃ©e Ã  cet examen"})]})})]},d.id)}),(!s||s.length===0)&&e.jsx(K,{children:e.jsx(B,{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:'Aucun examen blanc crÃ©Ã©. Cliquez sur "Nouvel examen" pour commencer.'})})]}),e.jsx(se,{open:N,onOpenChange:p,children:e.jsxs(te,{className:"!max-w-[90vw] !max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:T?"Modifier l'examen":"Nouvel examen blanc"}),e.jsx(ke,{children:"Configurez les paramÃ¨tres de l'examen blanc et sÃ©lectionnez les questions"})]}),e.jsx("div",{className:"space-y-6",children:R?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx($,{className:"w-12 h-12 animate-spin text-blue-500 dark:text-blue-400"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Chargement des questions..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"title",children:"Nom de l'examen"}),e.jsx(M,{id:"title",value:a.title,onChange:d=>v({...a,title:d.target.value}),placeholder:"Ex: Examen blanc 1"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"duration",children:"DurÃ©e (minutes)"}),e.jsx(M,{id:"duration",type:"number",value:a.duration_minutes,onChange:d=>v({...a,duration_minutes:parseInt(d.target.value)}),min:1})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"passing_score",children:"Note minimale (%)"}),e.jsx(M,{id:"passing_score",type:"number",value:a.passing_score,onChange:d=>v({...a,passing_score:parseInt(d.target.value)}),min:0,max:100})]})]}),e.jsx("div",{className:"border-t pt-4",children:R?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx($,{className:"w-6 h-6 animate-spin text-blue-500 dark:text-blue-400 mr-2"}),e.jsx("span",{className:"dark:text-gray-400",children:"Chargement des questions..."})]}):e.jsx(dt,{selectedQuestionIds:y,onSelectionChange:j})})]})}),e.jsxs(re,{children:[e.jsx(A,{variant:"outline",onClick:V,children:"Annuler"}),e.jsx(A,{onClick:L,disabled:o||!a.title||y.length===0,children:o?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2 animate-spin"}),"Enregistrement..."]}):`Enregistrer (${y.length} questions)`})]})]})})]})}function mt(){const{activeStudents:s,inactiveStudents:r,isLoading:c,error:x,selectedUserStats:C,fetchStudents:f,fetchUserStatistics:N,clearSelectedUser:p}=Us(),[T,b]=i.useState(!1),[o,u]=i.useState(!1),[y,j]=i.useState(null),[R,m]=i.useState(null),[g,w]=i.useState(null),[E,h]=i.useState(!1),[U,q]=i.useState(!1),[a,v]=i.useState(null),[I,V]=i.useState(!1),[L,z]=i.useState({activation_start_date:new Date().toISOString().split("T")[0],activation_weeks:4}),[F,d]=i.useState({name:"",email:"",activation_start_date:new Date().toISOString().split("T")[0],activation_weeks:4}),Q=async t=>{g===t?(w(null),p()):(w(t),await N(t))},P=async t=>{if(t.preventDefault(),j(null),m(null),!F.name.trim()||!F.email.trim()){j("Veuillez remplir tous les champs");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F.email)){j("Veuillez entrer une adresse email valide");return}if(F.activation_weeks<1||F.activation_weeks>52){j("La durÃ©e d'activation doit Ãªtre entre 1 et 52 semaines");return}try{u(!0),await Ts.createUser({name:F.name.trim(),email:F.email.trim().toLowerCase(),activation_start_date:F.activation_start_date,activation_weeks:F.activation_weeks});const D=new Date(F.activation_start_date);D.setDate(D.getDate()+F.activation_weeks*7),m(`Utilisateur "${F.name}" crÃ©Ã© avec succÃ¨s ! 
        Mot de passe: student123 
        Actif jusqu'au ${D.toLocaleDateString("fr-FR")}`),d({name:"",email:"",activation_start_date:new Date().toISOString().split("T")[0],activation_weeks:4}),b(!1),await f(),setTimeout(()=>m(null),7e3)}catch(D){j(D.message||"Erreur lors de la crÃ©ation de l'utilisateur")}finally{u(!1)}},O=()=>{d({name:"",email:"",activation_start_date:new Date().toISOString().split("T")[0],activation_weeks:4}),j(null),b(!1)},n=t=>{const l=[...s,...r].find(ve=>ve.id===t);if(!l)return;v(l);const D=l.activation_start_date?new Date(l.activation_start_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];let S=4;if(l.activation_start_date&&l.activation_end_date){const ve=new Date(l.activation_start_date),xs=new Date(l.activation_end_date),hs=Math.abs(xs.getTime()-ve.getTime()),ps=Math.ceil(hs/(1e3*60*60*24));S=Math.ceil(ps/7)}z({activation_start_date:D,activation_weeks:S}),q(!0)},_=async t=>{if(t.preventDefault(),!!a){if(j(null),m(null),L.activation_weeks<1||L.activation_weeks>104){j("La durÃ©e d'activation doit Ãªtre entre 1 et 104 semaines (2 ans)");return}try{V(!0),await Os(a.id,L.activation_start_date,L.activation_weeks);const l=new Date(L.activation_start_date);l.setDate(l.getDate()+L.activation_weeks*7),m(`ValiditÃ© de "${a.name}" mise Ã  jour ! Actif jusqu'au ${l.toLocaleDateString("fr-FR")}`),q(!1),v(null),await f(),setTimeout(()=>m(null),7e3)}catch(l){j(l.message||"Erreur lors de la mise Ã  jour de la validitÃ©")}finally{V(!1)}}},W=()=>{v(null),z({activation_start_date:new Date().toISOString().split("T")[0],activation_weeks:4}),j(null),q(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gestion des utilisateurs"}),e.jsx("p",{className:"text-slate-600",children:"CrÃ©er de nouveaux comptes Ã©tudiants"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs(se,{open:T,onOpenChange:b,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(A,{children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Nouvel utilisateur"]})}),e.jsxs(te,{className:"!max-w-[500px]","aria-describedby":"create-user-description",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"CrÃ©er un nouvel utilisateur"}),e.jsx(ke,{id:"create-user-description",children:`L'utilisateur recevra automatiquement le mot de passe "student123"`})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[y&&e.jsxs(H,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(J,{children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"name",children:"Nom complet"}),e.jsx(M,{id:"name",type:"text",placeholder:"Ex: Jean Dupont",value:F.name,onChange:t=>d(l=>({...l,name:t.target.value})),disabled:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"email",children:"Adresse email"}),e.jsx(M,{id:"email",type:"email",placeholder:"jean.dupont@example.com",value:F.email,onChange:t=>d(l=>({...l,email:t.target.value})),disabled:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"activation_start_date",children:"Date de dÃ©but d'activation"}),e.jsx(M,{id:"activation_start_date",type:"date",value:F.activation_start_date,onChange:t=>d(l=>({...l,activation_start_date:t.target.value})),disabled:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"activation_weeks",children:"DurÃ©e d'activation (semaines)"}),e.jsx(M,{id:"activation_weeks",type:"number",min:"1",max:"52",placeholder:"Ex: 4",value:F.activation_weeks,onChange:t=>d(l=>({...l,activation_weeks:parseInt(t.target.value)||4})),disabled:o,required:!0}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Le compte sera actif pendant ",F.activation_weeks," semaine",F.activation_weeks>1?"s":""]})]}),e.jsxs(re,{className:"gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:O,disabled:o,children:"Annuler"}),e.jsx(A,{type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"CrÃ©ation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"CrÃ©er l'utilisateur"]})})]})]})]})]})})]}),R&&e.jsxs(H,{className:"border-green-200 bg-blue-50 text-green-800",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(J,{children:R})]}),e.jsx(se,{open:U,onOpenChange:q,children:e.jsxs(te,{className:"!max-w-[500px]","aria-describedby":"validity-dialog-description",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"Modifier la date de validitÃ©"}),e.jsxs(ke,{id:"validity-dialog-description",children:["Modifier la pÃ©riode d'activation pour ",a?.name]})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[y&&e.jsxs(H,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(J,{children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"validity_start_date",children:"Date de dÃ©but d'activation"}),e.jsx(M,{id:"validity_start_date",type:"date",value:L.activation_start_date,onChange:t=>z(l=>({...l,activation_start_date:t.target.value})),disabled:I,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"validity_weeks",children:"DurÃ©e d'activation (semaines)"}),e.jsx(M,{id:"validity_weeks",type:"number",min:"1",max:"104",placeholder:"Ex: 4",value:L.activation_weeks,onChange:t=>z(l=>({...l,activation_weeks:parseInt(t.target.value)||4})),disabled:I,required:!0}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Le compte sera actif pendant ",L.activation_weeks," semaine",L.activation_weeks>1?"s":""," ","(jusqu'au ",new Date(new Date(L.activation_start_date).getTime()+L.activation_weeks*7*24*60*60*1e3).toLocaleDateString("fr-FR"),")"]})]}),e.jsxs(re,{className:"gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:W,disabled:I,children:"Annuler"}),e.jsx(A,{type:"submit",disabled:I,children:I?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Mise Ã  jour..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Mettre Ã  jour"]})})]})]})]})}),x&&e.jsxs(H,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(J,{children:x})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Ã‰tudiants actifs (",s.length,")"]}),c?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600"})}):s.length===0?e.jsx(K,{children:e.jsx(B,{className:"p-8 text-center text-slate-500",children:"Aucun Ã©tudiant actif"})}):e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsx(Qe,{student:t,isExpanded:g===t.id,statistics:g===t.id?C:null,onToggleExpand:Q,isLoadingStats:c&&g===t.id,onUpdateValidity:n},t.id))})]}),r.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{className:"cursor-pointer hover:shadow-md transition-shadow border-slate-300",onClick:()=>h(!E),children:e.jsx(ce,{className:"pb-3",children:e.jsxs(oe,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Re,{className:"w-5 h-5"}),"Ã‰tudiants inactifs (",r.length,")"]}),E?e.jsx(Te,{className:"w-5 h-5 text-slate-500"}):e.jsx(ne,{className:"w-5 h-5 text-slate-500"})]})})}),E&&e.jsx("div",{className:"space-y-3",children:r.map(t=>e.jsx(Qe,{student:t,isExpanded:!1,statistics:null,onToggleExpand:()=>{},isLoadingStats:!1,isInactive:!0},t.id))})]})]})}function Qe({student:s,isExpanded:r,statistics:c,onToggleExpand:x,isLoadingStats:C,isInactive:f=!1,onUpdateValidity:N}){const[p,T]=i.useState(!1),b=u=>u===null||u<0?"text-red-600 bg-red-50":u<=7?"text-orange-600 bg-orange-50":u<=14?"text-yellow-600 bg-yellow-50":"text-green-600 bg-green-50",o=u=>u===null||u<0?"ExpirÃ©":u===0?"Expire aujourd'hui":u===1?"1 jour restant":`${u} jours restants`;return e.jsxs(K,{className:`transition-all ${f?"opacity-60 border-slate-300":"border-blue-200"}`,children:[e.jsx(ce,{className:"pb-3 cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>!f&&x(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(oe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),s.name]}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!f&&s.days_remaining!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${b(s.days_remaining)}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4"}),o(s.days_remaining)]})}),e.jsxs(A,{variant:"outline",size:"sm",onClick:u=>{u.stopPropagation(),N?.(s.id)},className:"flex items-center gap-1",children:[e.jsx(Ns,{className:"w-3 h-3"}),"Modifier"]})]}),f&&e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-slate-200 text-slate-600",children:"Inactif"}),!f&&(r?e.jsx(Te,{className:"w-5 h-5 text-slate-500"}):e.jsx(ne,{className:"w-5 h-5 text-slate-500"}))]})]})}),r&&!f&&e.jsx(B,{className:"pt-0 space-y-4 border-t",children:C?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx($,{className:"w-6 h-6 animate-spin text-blue-600"})}):c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-slate-700 flex items-center justify-between cursor-pointer hover:text-slate-900",onClick:()=>T(!p),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Progression par thÃ¨me"]}),p?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})]}),p&&(c.themeProgress&&c.themeProgress.length>0?e.jsx("div",{className:"space-y-2",children:c.themeProgress.map(u=>e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-slate-700",children:u.theme_name}),e.jsxs("span",{className:"text-sm text-slate-600",children:[u.completed_questions,"/",u.total_questions," questions"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${u.progress_percentage}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Progression: ",u.progress_percentage,"%"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"w-3 h-3"}),"Score: ",u.score,"%"]})]})]},u.theme_id))}):e.jsx("p",{className:"text-sm text-slate-500 italic",children:"Aucune progression enregistrÃ©e"}))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4"}),"Examens blancs"]}),c.mockExamStats?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ws,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Tentatives"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.mockExamStats.total_attempts})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_s,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Meilleure note"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[c.mockExamStats.best_score,"%"]})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Me,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Moyenne"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[c.mockExamStats.average_score,"%"]})]})]}):e.jsx("p",{className:"text-sm text-slate-500 italic",children:"Aucun examen blanc effectuÃ©"})]})]}):e.jsx("p",{className:"text-sm text-slate-500 italic",children:"Erreur lors du chargement des statistiques"})})]})}function jt({user:s,onLogout:r}){const[c,x]=i.useState("themes"),{isDarkMode:C,toggleDarkMode:f}=Fs();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl mb-2",children:"Tableau de bord administrateur"}),e.jsxs("p",{className:"text-gray-600",children:["Bienvenue, ",s.name||s.email.split("@")[0]]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{variant:"outline",onClick:f,className:"p-2",title:C?"Mode clair":"Mode sombre",children:C?e.jsx(Cs,{className:"w-5 h-5"}):e.jsx(Ss,{className:"w-5 h-5"})}),e.jsxs(A,{variant:"outline",onClick:r,children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"DÃ©connexion"]})]})]}),e.jsxs(at,{value:c,onValueChange:x,className:"space-y-8",children:[e.jsx("div",{className:"w-full bg-white rounded-xl shadow-md p-4 border border-slate-200",children:e.jsxs(it,{className:"h-auto bg-transparent p-0 flex flex-wrap gap-3 justify-start border-0",children:[e.jsx(he,{value:"themes",className:"data-[state=active]:bg-purple-600 data-[state=active]:text-white data-[state=inactive]:bg-slate-100 data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:bg-slate-200 py-3 px-6 text-base font-semibold rounded-lg transition-all duration-200 shadow-sm hover:shadow-md border-0",children:"ðŸ“š ThÃ¨mes"}),e.jsx(he,{value:"questions",className:"data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:bg-slate-100 data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:bg-slate-200 py-3 px-6 text-base font-semibold rounded-lg transition-all duration-200 shadow-sm hover:shadow-md border-0",children:"â“ Questions"}),e.jsx(he,{value:"exams",className:"data-[state=active]:bg-orange-600 data-[state=active]:text-white data-[state=inactive]:bg-slate-100 data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:bg-slate-200 py-3 px-6 text-base font-semibold rounded-lg transition-all duration-200 shadow-sm hover:shadow-md border-0",children:"ðŸ“ Examens blancs"}),e.jsx(he,{value:"users",className:"data-[state=active]:bg-green-600 data-[state=active]:text-white data-[state=inactive]:bg-slate-100 data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:bg-slate-200 py-3 px-6 text-base font-semibold rounded-lg transition-all duration-200 shadow-sm hover:shadow-md border-0",children:"ðŸ‘¥ Utilisateurs"})]})}),e.jsx(pe,{value:"themes",children:e.jsx(lt,{})}),e.jsx(pe,{value:"questions",children:e.jsx(ot,{})}),e.jsx(pe,{value:"exams",children:e.jsx(ut,{})}),e.jsx(pe,{value:"users",children:e.jsx(mt,{})})]})]})})}export{jt as AdminDashboard};
