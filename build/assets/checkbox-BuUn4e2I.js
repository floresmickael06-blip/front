import{a as s}from"./index-CBcScvnd.js";import{r as l}from"./vendor-Ko1KMr1j.js";import{j as h,ai as X,c as A,b as J,l as Y,O as Z,m as Q,u as ee,r as T,q as B,w as te,v as ae,aj as se}from"./ui-components-CWudljTY.js";const R=async()=>{const t=await s.get("/themes");return t.data.data||t.data},re=async()=>{const t=await s.get("/themes/with-progress");return t.data.data||t.data},ne=async t=>{const e=await s.get(`/themes/${t}`);return e.data.data||e.data},oe=async t=>{const e=await s.post("/themes",t);return e.data.data||e.data},ce=async(t,e)=>{const a=await s.put(`/themes/${t}`,e);return a.data.data||a.data},ie=async t=>{await s.delete(`/themes/${t}`)},N=async t=>{const e=await s.get(`/questions/theme/${t}`);return e.data.data||e.data},de=async()=>{const t=await R();return await Promise.all(t.map(async a=>{try{const c=await N(a.id);return{...a,questions:c}}catch(c){return console.error(`Erreur lors de la rÃ©cupÃ©ration des questions du thÃ¨me ${a.id}:`,c),{...a,questions:[]}}}))},ue=async(t,e)=>(await s.post(`/themes/${t}/questions`,e)).data,le=async(t,e)=>(await s.put(`/questions/${t}`,e)).data,me=async t=>{await s.delete(`/questions/${t}`)},pe=async t=>(await s.post("/progress/theme",t)).data,Ue={getAllThemes:R,getThemesWithProgress:re,getThemeById:ne,createTheme:oe,updateTheme:ce,deleteTheme:ie,getQuestionsByTheme:N,getAllThemesWithQuestions:de,createQuestion:ue,updateQuestion:le,deleteQuestion:me,submitAnswer:pe},ge=async()=>{const t=await s.get("/mock-exams");return t.data.data||t.data},he=async t=>{const e=await s.get(`/mock-exams/${t}`);return e.data.data||e.data},xe=async t=>{const e=await s.get(`/mock-exams/${t}/questions`),a=e.data.data||e.data,c=await Promise.all(a.questions.map(async d=>{try{const i=await s.get(`/questions/${d.id}`);return{...d,image_url:i.data.data?.image_url||null,voice_url:i.data.data?.voice_url||null,subcategory:i.data.data?.subcategory||null}}catch{return console.warn(`âš ï¸ Impossible de charger les mÃ©dias pour la question ${d.id}`),d}}));return{...a.mock_exam,questions:c,question_count:a.question_count}},ye=async(t,e)=>{const a=await s.get(`/mock-exams/${t}/questions/${e}`);return a.data.data||a.data},fe=async(t,e)=>(await s.post("/progress/exam",{exam_id:t,...e})).data,we=async t=>{const e=await s.post("/mock-exams",t);return e.data.data||e.data},be=async(t,e)=>{const a=await s.put(`/mock-exams/${t}`,e);return a.data.data||a.data},Ee=async t=>{await s.delete(`/mock-exams/${t}`)},ke=async t=>{await s.post("/mock-exams/questions",t)},ve=async t=>(await s.post("/mock-exams/questions/batch",t)).data,W=async(t,e)=>{await s.delete(`/mock-exams/${t}/questions/${e}`)},Ce=async(t,e)=>{await Promise.all(e.map(a=>W(t,a)))},qe=async()=>{const t=await s.get("/mock-exams/next");return t.data.data||t.data},$e=async()=>{const t=await s.get("/progress/exam-history");return t.data.data||t.data},_e=async t=>{const e=await s.get(`/progress/exam-attempt/${t}`);return e.data.data||e.data},b={getAllMockExams:ge,getMockExamById:he,getMockExamQuestions:xe,getMockExamQuestionByIndex:ye,submitMockExam:fe,createMockExam:we,updateMockExam:be,deleteMockExam:Ee,addQuestionToExam:ke,addQuestionsToExamBatch:ve,removeQuestionFromExam:W,removeAllQuestionsFromExam:Ce,getNextMockExam:qe,getExamHistory:$e,getExamAttemptDetail:_e},Ve=()=>{const[t,e]=l.useState([]),[a,c]=l.useState(null),[d,i]=l.useState(null),[f,w]=l.useState([]),[x,m]=l.useState(!0),[E,n]=l.useState(null),y=async()=>{try{m(!0),n(null);const r=await b.getAllMockExams();console.log("ðŸ“¦ Response getAllMockExams:",r),Array.isArray(r)?e(r):(console.error("âŒ La rÃ©ponse n'est pas un tableau:",r),e([]),n("Format de rÃ©ponse invalide"))}catch(r){console.error("âŒ Erreur chargement examens:",r),n(r.response?.data?.message||"Erreur lors du chargement des examens"),e([])}finally{m(!1)}},q=async r=>{try{m(!0),n(null);const o=await b.getMockExamQuestions(r);return c(o),o}catch(o){throw console.error("âŒ Erreur chargement examen:",o),n(o.response?.data?.message||"Erreur lors du chargement de l'examen"),o}finally{m(!1)}},k=async(r,o)=>{try{return n(null),await b.submitMockExam(r,o)}catch(u){throw console.error("âŒ Erreur soumission examen:",u),n(u.response?.data?.message||"Erreur lors de la soumission"),u}},v=async r=>{try{n(null);const o=await b.createMockExam(r);return e(u=>[...u,o]),o}catch(o){throw console.error("âŒ Erreur crÃ©ation examen:",o),n(o.response?.data?.message||"Erreur lors de la crÃ©ation"),o}},$=async(r,o)=>{try{n(null);const u=await b.updateMockExam(r,o);e(K=>K.map(j=>j.id===r?u:j))}catch(u){throw console.error("âŒ Erreur mise Ã  jour examen:",u),n(u.response?.data?.message||"Erreur lors de la mise Ã  jour"),u}},p=async r=>{try{n(null),await b.deleteMockExam(r),e(o=>o.filter(u=>u.id!==r))}catch(o){throw console.error("âŒ Erreur suppression examen:",o),n(o.response?.data?.message||"Erreur lors de la suppression"),o}},g=async()=>{try{m(!0),n(null);const r=await b.getNextMockExam();return i(r),r}catch(r){throw console.error("âŒ Erreur chargement examen suivant:",r),n(r.response?.data?.message||"Erreur lors du chargement de l'examen suivant"),r}finally{m(!1)}},_=async()=>{try{m(!0),n(null);const r=await b.getExamHistory();return w(r),r}catch(r){throw console.error("âŒ Erreur chargement historique examens:",r),n(r.response?.data?.message||"Erreur lors du chargement de l'historique"),r}finally{m(!1)}},I=async r=>{try{return n(null),await b.getExamAttemptDetail(r)}catch(o){throw console.error("âŒ Erreur chargement dÃ©tail tentative:",o),n(o.response?.data?.message||"Erreur lors du chargement de la tentative"),o}},M=async(r,o)=>{try{return n(null),await b.getMockExamQuestionByIndex(r,o)}catch(u){throw console.error("âŒ Erreur chargement question:",u),n(u.response?.data?.message||"Erreur lors du chargement de la question"),u}};return l.useEffect(()=>{y()},[]),{exams:t,currentExam:a,nextExam:d,examHistory:f,isLoading:x,error:E,fetchAll:y,fetchById:q,fetchNextExam:g,fetchExamHistory:_,fetchAttemptDetail:I,fetchQuestionByIndex:M,submitExam:k,createExam:v,updateExam:$,deleteExam:p}},Ie=async()=>{const t=await s.get("/users/me");return t.data.data||t.data},Me=async()=>{const t=await s.get("/users/me/statistics");return t.data.data||t.data},Se=async()=>{const t=await s.get("/users/students");return t.data.data||t.data},Qe=async t=>{const e=await s.get(`/users/${t}/statistics`);return e.data.data||e.data},Pe=async t=>{const e=await s.get(`/users/${t}/progress/themes`);return e.data.data||e.data},je=async t=>{const e=await s.get(`/users/${t}/progress/mock-exams`);return e.data.data||e.data},D=async(t,e)=>{const a=await s.put(`/users/${t}`,e);if(!a.data.success)throw new Error(a.data.message||"Erreur lors de la mise Ã  jour de l'utilisateur")},Be=async(t,e,a)=>{await D(t,{activation_start_date:e,activation_weeks:a})},ze={getMyProfile:Ie,getStudentProfile:Me,getStudents:Se,getUserStatistics:Qe,getUserThemeProgress:Pe,getUserMockExamStats:je,updateUser:D,updateUserValidity:Be};class Ae{async getByTheme(e){const{data:a}=await s.get(`/questions/theme/${e}`);return a.success&&a.data?a.data:[]}async getById(e){const{data:a}=await s.get(`/questions/${e}`);if(a.success&&a.data)return a.data;throw new Error("Question non trouvÃ©e")}async create(e){const{data:a}=await s.post("/questions",e);if(a.success&&a.data)return a.data;throw new Error(a.message||"Erreur lors de la crÃ©ation")}async update(e,a){const{data:c}=await s.put(`/questions/${e}`,a);if(!c.success)throw new Error(c.message||"Erreur lors de la mise Ã  jour");return c.data||{}}async delete(e){const{data:a}=await s.delete(`/questions/${e}`);if(!a.success)throw new Error(a.message||"Erreur lors de la suppression")}async getQuestionsWithImages(){const{data:e}=await s.get("/questions/media/images");return e.success&&e.data?e.data:[]}async getQuestionsWithImagesByTheme(e){const{data:a}=await s.get(`/questions/media/images/${e}`);return a.success&&a.data?a.data:[]}async getQuestionsWithVoices(){const{data:e}=await s.get("/questions/media/voices");return e.success&&e.data?e.data:[]}async getQuestionsWithVoicesByTheme(e){const{data:a}=await s.get(`/questions/media/voices/${e}`);return a.success&&a.data?a.data:[]}async getQuestionImage(e){const{data:a}=await s.get(`/questions/${e}/image`);if(a.success&&a.data)return a.data;throw new Error("Image non trouvÃ©e")}async getQuestionVoice(e){const{data:a}=await s.get(`/questions/${e}/voice`);if(a.success&&a.data)return a.data;throw new Error("Audio non trouvÃ©")}async getAnsweredQuestionIds(e){const{data:a}=await s.get(`/questions/theme/${e}/answered`);return a.success&&a.data?a.data.answered_questions||[]:[]}async validate(e,a){const{data:c}=await s.post(`/questions/${e}/validate`,{user_answer:a});if(c.success&&c.data)return{isCorrect:c.data.is_correct,correctAnswer:c.data.correct_answer,explanation:c.data.explanation||""};throw new Error(c.message||"Erreur lors de la validation")}async resetThemeProgress(e){const{data:a}=await s.delete(`/progress/theme/${e}`);if(!a.success)throw new Error(a.message||"Erreur lors de la rÃ©initialisation")}}const Oe=new Ae,Te=J("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ge({className:t,variant:e,asChild:a=!1,...c}){const d=a?X:"span";return h.jsx(d,{"data-slot":"badge",className:A(Te({variant:e}),t),...c})}var S="Checkbox",[Re]=Y(S),[Ne,P]=Re(S);function We(t){const{__scopeCheckbox:e,checked:a,children:c,defaultChecked:d,disabled:i,form:f,name:w,onCheckedChange:x,required:m,value:E="on",internal_do_not_use_render:n}=t,[y,q]=ee({prop:a,defaultProp:d??!1,onChange:x,caller:S}),[k,v]=l.useState(null),[$,p]=l.useState(null),g=l.useRef(!1),_=k?!!f||!!k.closest("form"):!0,I={checked:y,disabled:i,setChecked:q,control:k,setControl:v,name:w,form:f,value:E,hasConsumerStoppedPropagationRef:g,required:m,defaultChecked:C(d)?!1:d,isFormControl:_,bubbleInput:$,setBubbleInput:p};return h.jsx(Ne,{scope:e,...I,children:De(n)?n(I):c})}var H="CheckboxTrigger",F=l.forwardRef(({__scopeCheckbox:t,onKeyDown:e,onClick:a,...c},d)=>{const{control:i,value:f,disabled:w,checked:x,required:m,setControl:E,setChecked:n,hasConsumerStoppedPropagationRef:y,isFormControl:q,bubbleInput:k}=P(H,t),v=T(d,E),$=l.useRef(x);return l.useEffect(()=>{const p=i?.form;if(p){const g=()=>n($.current);return p.addEventListener("reset",g),()=>p.removeEventListener("reset",g)}},[i,n]),h.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":C(x)?"mixed":x,"aria-required":m,"data-state":G(x),"data-disabled":w?"":void 0,disabled:w,value:f,...c,ref:v,onKeyDown:B(e,p=>{p.key==="Enter"&&p.preventDefault()}),onClick:B(a,p=>{n(g=>C(g)?!0:!g),k&&q&&(y.current=p.isPropagationStopped(),y.current||p.stopPropagation())})})});F.displayName=H;var L=l.forwardRef((t,e)=>{const{__scopeCheckbox:a,name:c,checked:d,defaultChecked:i,required:f,disabled:w,value:x,onCheckedChange:m,form:E,...n}=t;return h.jsx(We,{__scopeCheckbox:a,checked:d,defaultChecked:i,disabled:w,required:f,onCheckedChange:m,name:c,form:E,value:x,internal_do_not_use_render:({isFormControl:y})=>h.jsxs(h.Fragment,{children:[h.jsx(F,{...n,ref:e,__scopeCheckbox:a}),y&&h.jsx(O,{__scopeCheckbox:a})]})})});L.displayName=S;var U="CheckboxIndicator",V=l.forwardRef((t,e)=>{const{__scopeCheckbox:a,forceMount:c,...d}=t,i=P(U,a);return h.jsx(Z,{present:c||C(i.checked)||i.checked===!0,children:h.jsx(Q.span,{"data-state":G(i.checked),"data-disabled":i.disabled?"":void 0,...d,ref:e,style:{pointerEvents:"none",...t.style}})})});V.displayName=U;var z="CheckboxBubbleInput",O=l.forwardRef(({__scopeCheckbox:t,...e},a)=>{const{control:c,hasConsumerStoppedPropagationRef:d,checked:i,defaultChecked:f,required:w,disabled:x,name:m,value:E,form:n,bubbleInput:y,setBubbleInput:q}=P(z,t),k=T(a,q),v=te(i),$=ae(c);l.useEffect(()=>{const g=y;if(!g)return;const _=window.HTMLInputElement.prototype,M=Object.getOwnPropertyDescriptor(_,"checked").set,r=!d.current;if(v!==i&&M){const o=new Event("click",{bubbles:r});g.indeterminate=C(i),M.call(g,C(i)?!1:i),g.dispatchEvent(o)}},[y,v,i,d]);const p=l.useRef(C(i)?!1:i);return h.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:f??p.current,required:w,disabled:x,name:m,value:E,form:n,...e,tabIndex:-1,ref:k,style:{...e.style,...$,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});O.displayName=z;function De(t){return typeof t=="function"}function C(t){return t==="indeterminate"}function G(t){return C(t)?"indeterminate":t?"checked":"unchecked"}function Ke({className:t,...e}){return h.jsx(L,{"data-slot":"checkbox",className:A("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...e,children:h.jsx(V,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:h.jsx(se,{className:"size-3.5"})})})}export{Ge as B,Ke as C,Ve as a,ce as b,oe as c,ie as d,de as e,xe as f,R as g,ve as h,Be as i,Oe as q,Ce as r,Ue as t,ze as u};
