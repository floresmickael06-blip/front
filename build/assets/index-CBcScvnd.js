const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StudentDashboard-DAfFAAZ0.js","assets/ui-components-CWudljTY.js","assets/vendor-Ko1KMr1j.js","assets/checkbox-BuUn4e2I.js","assets/StudentDashboard-se7re9nv.css","assets/AdminDashboard-Marp6Ufn.js"])))=>i.map(i=>d[i]);
import{j as e,A as D,G as U,P as O,M as R,a as T,C as N,L,c as S,b as M,d as z,e as F,f as q,g as V,h as B,i as $,k as v,I as j,B as J}from"./ui-components-CWudljTY.js";import{a as G,d as W,r as o}from"./vendor-Ko1KMr1j.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(a){if(a.ep)return;a.ep=!0;const c=r(a);fetch(a.href,c)}})();var C,b=G;C=b.createRoot,b.hydrateRoot;const H="modulepreload",K=function(s){return"/app-bateau-client/"+s},w={},E=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=l?.nonce||l?.getAttribute("nonce");a=Promise.allSettled(r.map(d=>{if(d=K(d),d in w)return;w[d]=!0;const p=d.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const u=document.createElement("link");if(u.rel=p?"stylesheet":H,p||(u.as="script"),u.crossOrigin="",u.href=d,h&&u.setAttribute("nonce",h),document.head.appendChild(u),p)return new Promise((m,i)=>{u.addEventListener("load",m),u.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${d}`)))})}))}function c(l){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l}return a.then(l=>{for(const h of l||[])h.status==="rejected"&&c(h.reason);return t().catch(c)})},k="https://libertyloc-backend-production-2615.up.railway.app/api";console.log("ðŸŒ API URL configurÃ©e:",k);console.log("ðŸ”§ Mode:","PRODUCTION");const x=W.create({baseURL:k,withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:15e3});x.interceptors.request.use(s=>{const t=localStorage.getItem("auth_token");return t&&s.headers&&(s.headers.Authorization=`Bearer ${t}`),console.log(`ðŸ“¤ ${s.method?.toUpperCase()} ${s.url}`,{headers:s.headers,data:s.data}),s},s=>(console.error("âŒ Erreur requÃªte:",s),Promise.reject(s)));x.interceptors.response.use(s=>(console.log(`âœ… ${s.config.method?.toUpperCase()} ${s.config.url}`,{status:s.status,data:s.data}),s),s=>(console.error("âŒ Erreur rÃ©ponse:",{status:s.response?.status,message:s.response?.data?.message,url:s.config?.url}),s.response?.status===401&&(console.warn("âš ï¸ Token invalide - DÃ©connexion"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.pathname.includes("/")||(window.location.href="/")),Promise.reject({message:s.response?.data?.message||s.message||"Une erreur est survenue",status:s.response?.status,originalError:s})));const ue={AUDIO_BASE_URL:"",getAudioUrl:s=>s?s.startsWith("http://")||s.startsWith("https://")?s:s.startsWith("sounds/")?`https://iam-mickael.me/app-bateau-client/${s}`:`/${s}`:null};class X{async login(t){const{data:r}=await x.post("/auth/login",t);if(r.success){const n={token:r.token,user:r.user};return localStorage.setItem("auth_token",n.token),localStorage.setItem("user_data",JSON.stringify(n.user)),n}throw new Error(r.message||"Erreur de connexion")}async verifyToken(){const{data:t}=await x.get("/auth/verify"),r=t.user||t.data?.user;if(t.success&&r)return localStorage.setItem("user_data",JSON.stringify(r)),r;throw new Error("Token invalide")}async updateFirstLogin(){const{data:t}=await x.put("/auth/first-login");if(t.success){const r=this.getCurrentUser();r&&(r.firstLogin=!1,localStorage.setItem("user_data",JSON.stringify(r)))}}async changePassword(t){const{data:r}=await x.put("/auth/change-password",t);if(!r.success)throw new Error(r.message||"Erreur lors du changement de mot de passe")}async createUser(t){const r={email:t.email,name:t.name,password:"student123",role:"student",activation_start_date:t.activation_start_date,activation_weeks:t.activation_weeks},{data:n}=await x.post("/auth/register",r);if(n.success)return n.user||n.data;throw new Error(n.message||"Erreur lors de la crÃ©ation de l'utilisateur")}logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.href="/app-bateau-client"}getCurrentUser(){const t=localStorage.getItem("user_data");return t?JSON.parse(t):null}isAuthenticated(){return!!localStorage.getItem("auth_token")}isAdmin(){return this.getCurrentUser()?.role==="admin"}getToken(){return localStorage.getItem("auth_token")}}const f=new X,P=o.createContext(void 0),Q=({children:s})=>{const[t,r]=o.useState(null),[n,a]=o.useState(!0),[c,l]=o.useState(null);o.useEffect(()=>{(async()=>{try{if(f.isAuthenticated()){const i=await f.verifyToken();r(i)}}catch{f.logout()}finally{a(!1)}})()},[]);const h=async m=>{try{l(null),a(!0);const i=await f.login(m);console.log("Login response:",i),r(i.user),console.log("User set:",i.user)}catch(i){throw console.error("Login error:",i),l(i.message||"Erreur de connexion"),i}finally{a(!1)}},d=()=>{f.logout(),r(null)},p=async()=>{try{await f.updateFirstLogin(),t&&r({...t,firstLogin:!1})}catch(m){console.error("Erreur mise Ã  jour premiÃ¨re connexion:",m)}},g=async()=>{try{const m=await f.verifyToken();r(m)}catch(m){console.error("Erreur rafraÃ®chissement utilisateur:",m)}},u={user:t,isLoading:n,isAuthenticated:!!t,isAdmin:t?.role==="admin",login:h,logout:d,updateFirstLogin:p,refreshUser:g,error:c};return e.jsx(P.Provider,{value:u,children:s})},_=()=>{const s=o.useContext(P);if(s===void 0)throw new Error("useAuth doit Ãªtre utilisÃ© dans un AuthProvider");return s};function Y({onBack:s}){return e.jsx("div",{className:"discover-screen",children:e.jsxs("div",{className:"discover-container",children:[e.jsxs("button",{onClick:s,className:"back-button-discover",children:[e.jsx(D,{size:20}),"Retour"]}),e.jsx("img",{className:"discover-logo",alt:"Logo LibertyLoc",src:"./logo-liberty-loc-1-1.png"}),e.jsx("h1",{className:"discover-title",children:"RÃ©ussis ton permis bateau avec LibertyLoc"}),e.jsxs("div",{className:"discover-content",children:[e.jsxs("section",{className:"discover-section",children:[e.jsx("h2",{children:"ðŸŽ¯ Ton partenaire de rÃ©vision"}),e.jsx("p",{children:"LibertyLoc est une application de rÃ©vision moderne et interactive, spÃ©cialement conÃ§ue pour t'aider Ã  prÃ©parer ton permis bateau cÃ´tier avec confiance."})]}),e.jsxs("section",{className:"discover-section",children:[e.jsx("h2",{children:"ðŸ’¡ Ce que tu vas trouver"}),e.jsxs("ul",{className:"discover-list",children:[e.jsx("li",{children:"âœ… Des questions par thÃ©matique pour rÃ©viser Ã  ton rythme"}),e.jsx("li",{children:"âœ… Des examens blancs pour te mettre en conditions rÃ©elles"}),e.jsx("li",{children:"âœ… Un suivi de ta progression pour mesurer tes progrÃ¨s"}),e.jsx("li",{children:"âœ… Un accÃ¨s mobile pour rÃ©viser partout, Ã  tout moment"})]})]}),e.jsxs("section",{className:"discover-section",children:[e.jsx("h2",{children:"ðŸŽ“ Apprendre avec un professionnel"}),e.jsx("p",{children:"Cette application a Ã©tÃ© dÃ©veloppÃ©e pour accompagner les formations dispensÃ©es par JoÃ«l Gual, formateur certifiÃ© et passionnÃ© de nautisme."})]}),e.jsxs("div",{className:"contact-section",children:[e.jsx("h2",{children:"ðŸ“ž Contactez votre formateur"}),e.jsxs("div",{className:"contact-card",children:[e.jsx("div",{className:"contact-header",children:e.jsx("h3",{children:"JoÃ«l Gual - LibertyLoc"})}),e.jsxs("div",{className:"contact-info",children:[e.jsxs("a",{href:"https://libertyloc.fr",target:"_blank",rel:"noopener noreferrer",className:"contact-item contact-link",children:[e.jsx(U,{size:20}),e.jsx("span",{children:"libertyloc.fr"})]}),e.jsxs("a",{href:"tel:+33619132592",className:"contact-item contact-link",children:[e.jsx(O,{size:20}),e.jsx("span",{children:"06 19 13 25 92"})]}),e.jsxs("a",{href:"mailto:joel.gual@liberty-loc.com",className:"contact-item contact-link",children:[e.jsx(R,{size:20}),e.jsx("span",{children:"joel.gual@liberty-loc.com"})]}),e.jsxs("div",{className:"contact-item",children:[e.jsx(T,{size:20}),e.jsxs("span",{children:["22 Bis Avenue Augustin Labouilhe",e.jsx("br",{}),"31650 Saint-Orens-de-Gameville"]})]})]}),e.jsx("a",{href:"https://libertyloc.fr",target:"_blank",rel:"noopener noreferrer",className:"visit-website-button",children:"Visiter le site web"})]})]}),e.jsxs("div",{className:"discover-cta",children:[e.jsx("p",{className:"cta-text",children:"PrÃªt Ã  commencer ton aventure nautique ?"}),e.jsx("p",{className:"cta-subtext",children:"Contacte JoÃ«l pour en savoir plus sur les formations et obtenir tes accÃ¨s !"})]})]})]})})}function Z(){const{login:s}=_(),[t,r]=o.useState(""),[n,a]=o.useState(""),[c,l]=o.useState(!1),[h,d]=o.useState(null),[p,g]=o.useState("welcome"),u=async m=>{if(m.preventDefault(),d(null),!t||!n){d("Veuillez remplir tous les champs");return}try{l(!0),await s({email:t,password:n})}catch(i){i.error==="ACCOUNT_EXPIRED"||i.message?.includes("expirÃ©")?d("Votre compte a expirÃ©. Veuillez contacter l'administrateur pour renouveler votre accÃ¨s."):d(i.message||"Email ou mot de passe incorrect")}finally{l(!1)}};return p==="discover"?e.jsx(Y,{onBack:()=>g("welcome")}):p==="welcome"?e.jsxs("div",{className:"login-welcome-screen",children:[e.jsx("img",{className:"welcome-logo",alt:"Logo LibertyLoc",src:"./logo-liberty-loc-1-1.png"}),e.jsxs("p",{className:"welcome-text",children:[e.jsxs("span",{className:"welcome-title",children:["Bienvenue sur LibertyLoc",e.jsx("br",{})]}),e.jsx("span",{className:"welcome-subtitle",children:"L'application qui t'accompagne pour ton permis bateau"})]}),e.jsx("button",{className:"welcome-button discover-button",onClick:()=>g("discover"),children:"DÃ©couvrir l'app"}),e.jsx("button",{className:"welcome-button login-button",onClick:()=>g("login"),children:"Se connecter"})]}):e.jsx("div",{className:"login-screen",children:e.jsxs("div",{className:"login-container",children:[e.jsx("img",{className:"login-logo",alt:"Logo LibertyLoc",src:"./logo-liberty-loc-1-1.png"}),e.jsx("h1",{className:"login-title",children:"Se connecter"}),e.jsxs("form",{onSubmit:u,className:"login-form",children:[h&&e.jsxs("div",{className:"login-error",children:[e.jsx(N,{size:16}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",placeholder:"exemple@email.com",value:t,onChange:m=>r(m.target.value),disabled:c,autoComplete:"email",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"Mot de passe"}),e.jsx("input",{id:"password",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:n,onChange:m=>a(m.target.value),disabled:c,autoComplete:"current-password",className:"form-input"})]}),e.jsx("button",{type:"submit",disabled:c,className:"submit-button",children:c?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"spinner",size:20}),"Connexion..."]}):"Se connecter"}),e.jsx("button",{type:"button",onClick:()=>g("welcome"),className:"back-button",children:"Retour"})]})]})})}const ee=M("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function se({className:s,variant:t,...r}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:S(ee({variant:t}),s),...r})}function te({className:s,...t}){return e.jsx("div",{"data-slot":"alert-description",className:S("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}function re({email:s,onPasswordChanged:t}){const[r,n]=o.useState(""),[a,c]=o.useState(""),[l,h]=o.useState(""),[d,p]=o.useState(!1),[g,u]=o.useState(null),m=async i=>{if(i.preventDefault(),u(null),!r||!a||!l){u("Veuillez remplir tous les champs");return}if(a.length<6){u("Le nouveau mot de passe doit contenir au moins 6 caractÃ¨res");return}if(a!==l){u("Les mots de passe ne correspondent pas");return}if(r===a){u("Le nouveau mot de passe doit Ãªtre diffÃ©rent de l'ancien");return}try{p(!0),await f.changePassword({currentPassword:r,newPassword:a}),await f.updateFirstLogin(),t()}catch(I){u(I.message||"Erreur lors du changement de mot de passe")}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100 p-4",children:e.jsxs(z,{className:"w-full max-w-md",children:[e.jsxs(F,{className:"space-y-1 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"w-8 h-8 text-white"})}),e.jsx(V,{className:"text-2xl font-bold",children:"Changement de mot de passe requis"}),e.jsx(B,{children:"C'est votre premiÃ¨re connexion. Veuillez dÃ©finir un nouveau mot de passe pour sÃ©curiser votre compte."})]}),e.jsx($,{children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[g&&e.jsxs(se,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(te,{children:g})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"email",children:"Email (non modifiable)"}),e.jsx(j,{id:"email",type:"email",value:s,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"currentPassword",children:"Mot de passe actuel"}),e.jsx(j,{id:"currentPassword",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:r,onChange:i=>n(i.target.value),disabled:d,autoComplete:"current-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"newPassword",children:"Nouveau mot de passe"}),e.jsx(j,{id:"newPassword",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:a,onChange:i=>c(i.target.value),disabled:d,autoComplete:"new-password"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 6 caractÃ¨res"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"confirmPassword",children:"Confirmer le mot de passe"}),e.jsx(j,{id:"confirmPassword",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:l,onChange:i=>h(i.target.value),disabled:d,autoComplete:"new-password"})]}),e.jsx(J,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Modification en cours..."]}):"Changer le mot de passe"})]})})]})})}const ae=()=>{console.log("ðŸ”¥ Mode Backend: localStorage non initialisÃ© avec des donnÃ©es mockÃ©es")},oe=o.lazy(()=>E(()=>import("./StudentDashboard-DAfFAAZ0.js"),__vite__mapDeps([0,1,2,3,4])).then(s=>({default:s.StudentDashboard}))),ne=o.lazy(()=>E(()=>import("./AdminDashboard-Marp6Ufn.js"),__vite__mapDeps([5,1,2,3])).then(s=>({default:s.AdminDashboard}))),y=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]})});function ie(){const{user:s,logout:t,isLoading:r,refreshUser:n}=_();return o.useEffect(()=>{ae()},[]),r?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]})}):s?s.firstLogin===!0||s.firstLogin===1?e.jsx(re,{email:s.email,onPasswordChanged:n}):s.role==="admin"?e.jsx(o.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(ne,{user:s,onLogout:t})}):e.jsx(o.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(oe,{user:s,onLogout:t})}):e.jsx(Z,{})}const A=o.createContext(void 0);function ce({children:s}){const[t,r]=o.useState(()=>{const a=localStorage.getItem("darkMode");return a?JSON.parse(a):!1});o.useEffect(()=>{t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("darkMode",JSON.stringify(t))},[t]);const n=()=>{r(a=>!a)};return e.jsx(A.Provider,{value:{isDarkMode:t,toggleDarkMode:n},children:s})}function me(){const s=o.useContext(A);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s}C(document.getElementById("root")).render(e.jsx(ce,{children:e.jsx(Q,{children:e.jsx(ie,{})})}));export{se as A,ue as M,x as a,te as b,me as c,f as d,_ as u};
