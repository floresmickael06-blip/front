import{j as e,m as He,n as le,d as We,f as H,g as J,h as Y,o as Ee,k as W,B as U,L as oe,R as Ce,A as re,T as Xe,C as xe,p as Ye,u as Rs,q as Ps,r as ce,s as de,t as Ts,v as Ge,w as Ms,x as Ds,y as Je,V as qs,z as Is,S as $s,D as Qs,E as Ls,F as Ve,H as Fs,U as Be,J as zs,N as Vs}from"./ui-components-B_QGTPpA.js";import{r as o,b as Bs}from"./vendor-Ko1KMr1j.js";import{a as ge,u as Os,M as Ks,A as ye,b as _e,c as Us}from"./index-CU_JHw7m.js";import{t as he,u as Oe,B as be,C as ke,q as ie,a as Ze}from"./checkbox-CPvGMPaq.js";function Hs(s=!1){const[t,n]=o.useState([]),[r,l]=o.useState(!0),[h,d]=o.useState(null),a=async()=>{try{l(!0),d(null);const c=s?await he.getThemesWithProgress():await he.getAllThemes();console.log(`ðŸ“¦ Response ${s?"getThemesWithProgress":"getAllThemes"}:`,c),Array.isArray(c)?n(c):(console.error("âŒ La rÃ©ponse n'est pas un tableau:",c),n([]),d("Format de rÃ©ponse invalide"))}catch(c){console.error("âŒ Erreur lors du chargement des thÃ¨mes:",c),d(c.response?.data?.message||"Erreur lors du chargement des thÃ¨mes"),n([])}finally{l(!1)}},m=async c=>{try{d(null);const f=await he.createTheme(c);return n(N=>[...N,f]),f}catch(f){throw console.error("âŒ Erreur crÃ©ation thÃ¨me:",f),d(f.response?.data?.message||"Erreur lors de la crÃ©ation"),f}},u=async(c,f)=>{try{d(null);const N=await he.updateTheme(c,f);n(y=>y.map(w=>w.id===c?N:w))}catch(N){throw console.error("âŒ Erreur mise Ã  jour thÃ¨me:",N),d(N.response?.data?.message||"Erreur lors de la mise Ã  jour"),N}},x=async c=>{try{d(null),await he.deleteTheme(c),n(f=>f.filter(N=>N.id!==c))}catch(f){throw console.error("âŒ Erreur suppression thÃ¨me:",f),d(f.response?.data?.message||"Erreur lors de la suppression"),f}};return o.useEffect(()=>{a()},[s]),{themes:t,isLoading:r,error:h,refresh:a,fetchThemes:a,createTheme:m,updateTheme:u,deleteTheme:x}}const Ws=async()=>{const s=await ge.get("/progress");return s.data.data||s.data},Xs=async()=>{const s=await ge.get("/progress/stats");return s.data.data||s.data},Ys=async s=>{const t=await ge.get(`/progress/theme/${s}`);return t.data.data||t.data},Gs=async s=>{console.log("ðŸ“¤ submitThemeAnswer - DonnÃ©es envoyÃ©es:",s);const t=await ge.post("/progress/theme",s);return console.log("ðŸ“¥ submitThemeAnswer - RÃ©ponse reÃ§ue:",t.data),t.data.data||t.data},Js=async s=>{console.log("ðŸ“¤ submitExamResult - DonnÃ©es envoyÃ©es:",s);const t=await ge.post("/progress/exam",s);return console.log("ðŸ“¥ submitExamResult - RÃ©ponse reÃ§ue:",t.data),t.data.data||t.data},fe={getProgress:Ws,getProgressStats:Xs,getThemeProgress:Ys,submitThemeAnswer:Gs,submitExamResult:Js},Zs=()=>{const{user:s}=Os(),[t,n]=o.useState([]),[r,l]=o.useState([]),[h,d]=o.useState(null),[a,m]=o.useState(!0),[u,x]=o.useState(null),c=async()=>{if(s)try{m(!0),x(null);const y=await fe.getProgress();n(y.themes||[]),l(y.mockExams||[])}catch(y){console.error("âŒ Erreur chargement progression:",y),x(y.response?.data?.message||"Erreur lors du chargement de la progression"),n([]),l([])}finally{m(!1)}},f=async()=>{if(s)try{x(null);const y=await fe.getProgressStats();d(y)}catch(y){console.error("âŒ Erreur chargement stats:",y),x(y.response?.data?.message||"Erreur lors du chargement des statistiques")}},N=async y=>{try{x(null);const w=await fe.submitThemeAnswer(y);return await c(),w}catch(w){throw console.error("âŒ Erreur soumission rÃ©ponse:",w),x(w.response?.data?.message||"Erreur lors de la soumission"),w}};return o.useEffect(()=>{s&&(c(),f())},[s]),{themeProgress:t,mockExamProgress:r,stats:h,progressList:t,isLoading:a,error:u,fetchAllProgress:c,fetchStats:f,submitAnswer:N,refresh:c}};function et(){const[s,t]=o.useState(null),[n,r]=o.useState(null),[l,h]=o.useState(!0),[d,a]=o.useState(null),m=async()=>{try{h(!0),a(null);const u=await Oe.getMyProfile();r(u);const x=await Oe.getStudentProfile();t(x)}catch(u){console.error("Erreur lors de la rÃ©cupÃ©ration du profil:",u),a(u.message||"Erreur lors du chargement du profil")}finally{h(!1)}};return o.useEffect(()=>{m()},[]),{profile:s,userDetails:n,isLoading:l,error:d,refresh:m}}function es(s=1024){const[t,n]=o.useState(!1);return o.useEffect(()=>{const r=()=>{const l=window.innerWidth<s,h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),d="ontouchstart"in window||navigator.maxTouchPoints>0;n(l||h&&d)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[s]),t}var Me="Progress",De=100,[st]=He(Me),[tt,rt]=st(Me),ss=o.forwardRef((s,t)=>{const{__scopeProgress:n,value:r=null,max:l,getValueLabel:h=nt,...d}=s;(l||l===0)&&!Ke(l)&&console.error(at(`${l}`,"Progress"));const a=Ke(l)?l:De;r!==null&&!Ue(r,a)&&console.error(ot(`${r}`,"Progress"));const m=Ue(r,a)?r:null,u=je(m)?h(m,a):void 0;return e.jsx(tt,{scope:n,value:m,max:a,children:e.jsx(le.div,{"aria-valuemax":a,"aria-valuemin":0,"aria-valuenow":je(m)?m:void 0,"aria-valuetext":u,role:"progressbar","data-state":ns(m,a),"data-value":m??void 0,"data-max":a,...d,ref:t})})});ss.displayName=Me;var ts="ProgressIndicator",rs=o.forwardRef((s,t)=>{const{__scopeProgress:n,...r}=s,l=rt(ts,n);return e.jsx(le.div,{"data-state":ns(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...r,ref:t})});rs.displayName=ts;function nt(s,t){return`${Math.round(s/t*100)}%`}function ns(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function je(s){return typeof s=="number"}function Ke(s){return je(s)&&!isNaN(s)&&s>0}function Ue(s,t){return je(s)&&!isNaN(s)&&s<=t&&s>=0}function at(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${De}\`.`}function ot(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${De} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var lt=ss,it=rs;function Ae({className:s,value:t,...n}){return e.jsx(lt,{"data-slot":"progress",className:We("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...n,children:e.jsx(it,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}function ve(s){const t=/([^:]+)\s*:\s*\(([A-D])-([A-D])\)/g,n=[];let r;for(;(r=t.exec(s))!==null;){const h=r[1].trim(),d=r[2],a=r[3],m=[],u=d.charCodeAt(0),x=a.charCodeAt(0);for(let c=u;c<=x;c++)m.push(String.fromCharCode(c));n.push({text:h,options:m,startOption:d,endOption:a})}let l=s;if(n.length>0){const h=s.match(/([^:]+)\s*:\s*\(([A-D])-([A-D])\)/);if(h){const d=s.indexOf(h[1]);l=s.substring(0,d).trim(),l.endsWith(":")&&(l=l.slice(0,-1).trim())}}return{mainText:l||s,subQuestions:n}}function Ne(s){const t=/\([A-D]-[A-D]\)/g,n=s.match(t);return n!==null&&n.length>0}function as(s,t){return s.subQuestions.find(n=>n.options.includes(t))||null}function ct({theme:s,onBack:t,onComplete:n}){const[r,l]=o.useState([]),[h,d]=o.useState(!0),[a,m]=o.useState(null),[u,x]=o.useState(0),[c,f]=o.useState([]),[N,y]=o.useState([]),[w,v]=o.useState(!1),[_,q]=o.useState(!1),[P,A]=o.useState(!1),[D,B]=o.useState(!1),O=b=>{const E=[...b];for(let R=E.length-1;R>0;R--){const C=Math.floor(Math.random()*(R+1));[E[R],E[C]]=[E[C],E[R]]}return E};o.useEffect(()=>{(async()=>{try{d(!0),console.log("ðŸ”¥ ThemeQuizView: Chargement des questions pour le thÃ¨me",s.id);const E=await ie.getAnsweredQuestionIds(s.id);console.log("âœ… Questions dÃ©jÃ  rÃ©pondues:",E);const R=await ie.getByTheme(s.id);console.log("âœ… Total questions du thÃ¨me:",R.length);const C=R.filter(ee=>!E.includes(ee.id));console.log("âœ… Questions restantes Ã  rÃ©pondre:",C.length);const z=O(C);console.log("ðŸŽ² Questions mÃ©langÃ©es alÃ©atoirement"),l(z),m(null)}catch(E){console.error("âŒ Erreur chargement questions:",E),m(E.response?.data?.message||"Erreur lors du chargement des questions")}finally{d(!1)}})()},[s.id]);const k=r[u],Z=r.length>0?u/r.length*100:0,L=async()=>{try{B(!0),console.log("ðŸ”„ Recommencer le thÃ¨me:",s.id),await ie.resetThemeProgress(s.id),console.log("âœ… Progression rÃ©initialisÃ©e");const b=await ie.getByTheme(s.id),E=O(b);l(E),x(0),f([]),y([]),v(!1),m(null),console.log("âœ… ThÃ¨me redÃ©marrÃ© avec",E.length,"questions")}catch(b){console.error("âŒ Erreur lors du redÃ©marrage:",b),m("Erreur lors du redÃ©marrage du thÃ¨me")}finally{B(!1)}},$=b=>{f(E=>E.includes(b)?E.filter(R=>R!==b):[...E,b].sort())},M=b=>{k?.question_type==="true_false"?f([b]):$(b)},K=async()=>{if(!(c.length===0||!k)){q(!0);try{const b=c.join(","),E=await ie.validate(k.id,b);console.log("âœ… Validation question",k.id,"- Progression automatiquement enregistrÃ©e");const R={questionId:k.id,questionText:k.question_text,userAnswer:b,isCorrect:E.isCorrect,correctAnswer:E.correctAnswer||b,explanation:E.explanation||""},C=[...N,R];y(C),u<r.length-1?(x(u+1),f([])):(v(!0),console.log("ðŸŽ‰ Quiz terminÃ© !"),console.log("ðŸ“Š RÃ©sultats:",{total:C.length,correct:C.filter(z=>z.isCorrect).length,percentage:(C.filter(z=>z.isCorrect).length/C.length*100).toFixed(1)+"%"}))}catch(b){console.error("âŒ Erreur validation rÃ©ponse:",b),alert(b.response?.data?.message||"Erreur lors de la validation de la rÃ©ponse")}finally{q(!1)}}},G=()=>{x(0),f([]),y([]),v(!1)},Q=async()=>{A(!0);try{await n(),t()}catch(b){console.error("Erreur lors de la finalisation:",b),A(!1)}};if(h)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600",children:"Chargement des questions..."})]})});if(a||r.length===0)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(H,{className:"max-w-md w-full",children:[e.jsx(J,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Ee,{className:"w-5 h-5"}),r.length===0&&!a?"ThÃ¨me complÃ©tÃ© !":"Aucune question disponible"]})}),e.jsxs(W,{children:[e.jsx("p",{className:"text-slate-600 mb-6",children:r.length===0&&!a?"ðŸŽ‰ FÃ©licitations ! Vous avez rÃ©pondu Ã  toutes les questions de ce thÃ¨me.":a||"Ce thÃ¨me ne contient pas encore de questions."}),r.length===0&&!a&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(U,{onClick:L,className:"w-full bg-blue-600 hover:bg-blue-700",disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"RedÃ©marrage..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Recommencer ce thÃ¨me"]})}),e.jsxs(U,{onClick:t,variant:"outline",className:"w-full",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour au tableau de bord"]})]}),(a||r.length===0&&a)&&e.jsxs(U,{onClick:t,className:"w-full",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour au tableau de bord"]})]})]})});if(w){const b=N.filter(C=>C.isCorrect).length,E=Math.round(b/r.length*100),R=E>=50;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4",children:e.jsx("div",{className:"max-w-3xl mx-auto py-6",children:e.jsxs(H,{className:"border-2 border-slate-200",children:[e.jsxs(J,{className:"text-center pb-4",children:[e.jsx("div",{className:`w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center ${R?"bg-green-100":"bg-orange-100"}`,children:R?e.jsx(Xe,{className:"w-10 h-10 text-green-600"}):e.jsx(xe,{className:"w-10 h-10 text-orange-600"})}),e.jsx(Y,{className:"text-2xl",children:R?"FÃ©licitations !":"Quiz terminÃ©"}),e.jsxs("p",{className:"text-slate-600 mt-2",children:["ThÃ¨me : ",s.title]})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-5xl font-bold text-slate-800 mb-2",children:[E,"%"]}),e.jsxs("p",{className:"text-slate-600",children:[b," bonnes rÃ©ponses sur ",r.length]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:N.map(C=>e.jsx(H,{className:`border ${C.isCorrect?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[C.isCorrect?e.jsx(Ee,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(Ye,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:C.questionText}),e.jsxs("p",{className:"text-xs text-slate-600 mb-2",children:["Votre rÃ©ponse : ",e.jsx("span",{className:"font-semibold",children:C.userAnswer}),!C.isCorrect&&C.correctAnswer&&e.jsxs(e.Fragment,{children:[" â€¢ Bonne rÃ©ponse : ",e.jsx("span",{className:"font-semibold text-green-700",children:C.correctAnswer})]})]}),C.isCorrect&&C.correctAnswer.includes(",")&&e.jsx("p",{className:"text-xs text-green-600 mb-2",children:"âœ… Toutes les bonnes rÃ©ponses trouvÃ©es !"}),C.explanation&&e.jsxs("p",{className:"text-xs text-slate-500 italic bg-blue-50 p-2 rounded border border-blue-200",children:["ðŸ’¡ ",C.explanation]})]})]})})},C.questionId))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(U,{onClick:G,variant:"outline",className:"flex-1",disabled:P,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Recommencer"]}),e.jsx(U,{onClick:Q,className:"flex-1",disabled:P,children:P?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Chargement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour au dashboard"]})})]})]})]})})})}const F=k?k.question_type==="true_false"?[{key:"A",value:k.option_a||"Vrai"},{key:"B",value:k.option_b||"Faux"}]:[{key:"A",value:k.option_a},{key:"B",value:k.option_b},{key:"C",value:k.option_c},{key:"D",value:k.option_d}].filter(E=>E.value):[];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs(U,{variant:"outline",onClick:t,size:"sm",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs(be,{variant:"outline",className:"text-sm",children:["Question ",u+1," / ",r.length]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Ae,{value:Z,className:"h-2"})}),e.jsxs(H,{className:"border-2 border-slate-200",children:[e.jsx(J,{children:k&&(()=>{const b=ve(k.question_text);return Ne(k.question_text)&&b.subQuestions.length>0?e.jsx(Y,{className:"text-lg",children:b.mainText}):e.jsx(Y,{className:"text-lg",children:k.question_text})})()}),e.jsxs(W,{children:[k?.image_url&&e.jsx("div",{className:"mb-6 space-y-4",children:k.image_url.split(";").filter(b=>b.trim()).map((b,E)=>{const R=b.trim();let C=R;return!R.startsWith("http://")&&!R.startsWith("https://")&&(C=`/app-bateau-client/${R}`),e.jsx("div",{children:e.jsx("img",{src:C,alt:`Image de la question ${E+1}`,className:"w-full h-auto max-h-96 object-contain rounded-lg border border-slate-200",onError:z=>{console.error("Erreur chargement image:",C),z.target.style.display="none"}})},E)})}),e.jsxs("div",{className:"space-y-3 mb-6",children:[k?.question_type==="true_false"&&e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"SÃ©lectionnez une rÃ©ponse"}),k?.question_type==="multiple_choice"&&e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:k.correct_answer?.includes(",")?"âš ï¸ Plusieurs rÃ©ponses possibles - Cochez toutes les bonnes rÃ©ponses":"SÃ©lectionnez une ou plusieurs rÃ©ponses"}),k&&(()=>{const b=ve(k.question_text),E=Ne(k.question_text);return F.map((R,C)=>{const z=c.includes(R.key),ee=k?.question_type==="true_false";let ne=null;if(E&&b.subQuestions.length>0){const se=as(b,R.key);se&&(C===0||!se.options.includes(F[C-1].key))&&(ne=e.jsx("div",{className:"mt-4 mb-2 font-semibold text-slate-700",children:se.text},`subq-${R.key}`))}return e.jsxs(Bs.Fragment,{children:[ne,e.jsx("div",{onClick:()=>M(R.key),className:`w-full p-4 text-left rounded-lg border-2 transition-all cursor-pointer ${z?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[ee?e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${z?"border-blue-500 bg-blue-500":"border-slate-300"}`,children:z&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}):e.jsx(ke,{checked:z,onCheckedChange:()=>M(R.key),className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium text-slate-700",children:[R.key,". ",R.value]})]})})]},R.key)})})()]}),e.jsx(U,{onClick:K,disabled:c.length===0||_,className:"w-full",children:_?"Validation...":u<r.length-1?"Question suivante":"Terminer le quiz"})]})]})]})})}var os=["PageUp","PageDown"],ls=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],is={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ue="Slider",[Re,dt,ut]=Ps(ue),[cs]=He(ue,[ut]),[mt,we]=cs(ue),ds=o.forwardRef((s,t)=>{const{name:n,min:r=0,max:l=100,step:h=1,orientation:d="horizontal",disabled:a=!1,minStepsBetweenThumbs:m=0,defaultValue:u=[r],value:x,onValueChange:c=()=>{},onValueCommit:f=()=>{},inverted:N=!1,form:y,...w}=s,v=o.useRef(new Set),_=o.useRef(0),P=d==="horizontal"?ht:xt,[A=[],D]=Rs({prop:x,defaultProp:u,onChange:$=>{[...v.current][_.current]?.focus(),c($)}}),B=o.useRef(A);function O($){const M=jt(A,$);L($,M)}function k($){L($,_.current)}function Z(){const $=B.current[_.current];A[_.current]!==$&&f(A)}function L($,M,{commit:K}={commit:!1}){const G=St(h),Q=yt(Math.round(($-r)/h)*h+r,G),T=Ge(Q,[r,l]);D((F=[])=>{const b=pt(F,T,M);if(wt(b,m*h)){_.current=b.indexOf(T);const E=String(b)!==String(F);return E&&K&&f(b),E?b:F}else return F})}return e.jsx(mt,{scope:s.__scopeSlider,name:n,disabled:a,min:r,max:l,valueIndexToChangeRef:_,thumbs:v.current,values:A,orientation:d,form:y,children:e.jsx(Re.Provider,{scope:s.__scopeSlider,children:e.jsx(Re.Slot,{scope:s.__scopeSlider,children:e.jsx(P,{"aria-disabled":a,"data-disabled":a?"":void 0,...w,ref:t,onPointerDown:ce(w.onPointerDown,()=>{a||(B.current=A)}),min:r,max:l,inverted:N,onSlideStart:a?void 0:O,onSlideMove:a?void 0:k,onSlideEnd:a?void 0:Z,onHomeKeyDown:()=>!a&&L(r,0,{commit:!0}),onEndKeyDown:()=>!a&&L(l,A.length-1,{commit:!0}),onStepKeyDown:({event:$,direction:M})=>{if(!a){const Q=os.includes($.key)||$.shiftKey&&ls.includes($.key)?10:1,T=_.current,F=A[T],b=h*Q*M;L(F+b,T,{commit:!0})}}})})})})});ds.displayName=ue;var[us,ms]=cs(ue,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ht=o.forwardRef((s,t)=>{const{min:n,max:r,dir:l,inverted:h,onSlideStart:d,onSlideMove:a,onSlideEnd:m,onStepKeyDown:u,...x}=s,[c,f]=o.useState(null),N=de(t,P=>f(P)),y=o.useRef(void 0),w=Ts(l),v=w==="ltr",_=v&&!h||!v&&h;function q(P){const A=y.current||c.getBoundingClientRect(),D=[0,A.width],O=qe(D,_?[n,r]:[r,n]);return y.current=A,O(P-A.left)}return e.jsx(us,{scope:s.__scopeSlider,startEdge:_?"left":"right",endEdge:_?"right":"left",direction:_?1:-1,size:"width",children:e.jsx(hs,{dir:w,"data-orientation":"horizontal",...x,ref:N,style:{...x.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:P=>{const A=q(P.clientX);d?.(A)},onSlideMove:P=>{const A=q(P.clientX);a?.(A)},onSlideEnd:()=>{y.current=void 0,m?.()},onStepKeyDown:P=>{const D=is[_?"from-left":"from-right"].includes(P.key);u?.({event:P,direction:D?-1:1})}})})}),xt=o.forwardRef((s,t)=>{const{min:n,max:r,inverted:l,onSlideStart:h,onSlideMove:d,onSlideEnd:a,onStepKeyDown:m,...u}=s,x=o.useRef(null),c=de(t,x),f=o.useRef(void 0),N=!l;function y(w){const v=f.current||x.current.getBoundingClientRect(),_=[0,v.height],P=qe(_,N?[r,n]:[n,r]);return f.current=v,P(w-v.top)}return e.jsx(us,{scope:s.__scopeSlider,startEdge:N?"bottom":"top",endEdge:N?"top":"bottom",size:"height",direction:N?1:-1,children:e.jsx(hs,{"data-orientation":"vertical",...u,ref:c,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:w=>{const v=y(w.clientY);h?.(v)},onSlideMove:w=>{const v=y(w.clientY);d?.(v)},onSlideEnd:()=>{f.current=void 0,a?.()},onStepKeyDown:w=>{const _=is[N?"from-bottom":"from-top"].includes(w.key);m?.({event:w,direction:_?-1:1})}})})}),hs=o.forwardRef((s,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:l,onSlideEnd:h,onHomeKeyDown:d,onEndKeyDown:a,onStepKeyDown:m,...u}=s,x=we(ue,n);return e.jsx(le.span,{...u,ref:t,onKeyDown:ce(s.onKeyDown,c=>{c.key==="Home"?(d(c),c.preventDefault()):c.key==="End"?(a(c),c.preventDefault()):os.concat(ls).includes(c.key)&&(m(c),c.preventDefault())}),onPointerDown:ce(s.onPointerDown,c=>{const f=c.target;f.setPointerCapture(c.pointerId),c.preventDefault(),x.thumbs.has(f)?f.focus():r(c)}),onPointerMove:ce(s.onPointerMove,c=>{c.target.hasPointerCapture(c.pointerId)&&l(c)}),onPointerUp:ce(s.onPointerUp,c=>{const f=c.target;f.hasPointerCapture(c.pointerId)&&(f.releasePointerCapture(c.pointerId),h(c))})})}),xs="SliderTrack",fs=o.forwardRef((s,t)=>{const{__scopeSlider:n,...r}=s,l=we(xs,n);return e.jsx(le.span,{"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation,...r,ref:t})});fs.displayName=xs;var Pe="SliderRange",gs=o.forwardRef((s,t)=>{const{__scopeSlider:n,...r}=s,l=we(Pe,n),h=ms(Pe,n),d=o.useRef(null),a=de(t,d),m=l.values.length,u=l.values.map(f=>js(f,l.min,l.max)),x=m>1?Math.min(...u):0,c=100-Math.max(...u);return e.jsx(le.span,{"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,...r,ref:a,style:{...s.style,[h.startEdge]:x+"%",[h.endEdge]:c+"%"}})});gs.displayName=Pe;var Te="SliderThumb",ps=o.forwardRef((s,t)=>{const n=dt(s.__scopeSlider),[r,l]=o.useState(null),h=de(t,a=>l(a)),d=o.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return e.jsx(ft,{...s,ref:h,index:d})}),ft=o.forwardRef((s,t)=>{const{__scopeSlider:n,index:r,name:l,...h}=s,d=we(Te,n),a=ms(Te,n),[m,u]=o.useState(null),x=de(t,q=>u(q)),c=m?d.form||!!m.closest("form"):!0,f=Ms(m),N=d.values[r],y=N===void 0?0:js(N,d.min,d.max),w=bt(r,d.values.length),v=f?.[a.size],_=v?vt(v,y,a.direction):0;return o.useEffect(()=>{if(m)return d.thumbs.add(m),()=>{d.thumbs.delete(m)}},[m,d.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${_}px)`},children:[e.jsx(Re.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(le.span,{role:"slider","aria-label":s["aria-label"]||w,"aria-valuemin":d.min,"aria-valuenow":N,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...h,ref:x,style:N===void 0?{display:"none"}:s.style,onFocus:ce(s.onFocus,()=>{d.valueIndexToChangeRef.current=r})})}),c&&e.jsx(bs,{name:l??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:N},r)]})});ps.displayName=Te;var gt="RadioBubbleInput",bs=o.forwardRef(({__scopeSlider:s,value:t,...n},r)=>{const l=o.useRef(null),h=de(l,r),d=Ds(t);return o.useEffect(()=>{const a=l.current;if(!a)return;const m=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(m,"value").set;if(d!==t&&x){const c=new Event("input",{bubbles:!0});x.call(a,t),a.dispatchEvent(c)}},[d,t]),e.jsx(le.input,{style:{display:"none"},...n,ref:h,defaultValue:t})});bs.displayName=gt;function pt(s=[],t,n){const r=[...s];return r[n]=t,r.sort((l,h)=>l-h)}function js(s,t,n){const h=100/(n-t)*(s-t);return Ge(h,[0,100])}function bt(s,t){return t>2?`Value ${s+1} of ${t}`:t===2?["Minimum","Maximum"][s]:void 0}function jt(s,t){if(s.length===1)return 0;const n=s.map(l=>Math.abs(l-t)),r=Math.min(...n);return n.indexOf(r)}function vt(s,t,n){const r=s/2,h=qe([0,50],[0,r]);return(r-h(t)*n)*n}function Nt(s){return s.slice(0,-1).map((t,n)=>s[n+1]-t)}function wt(s,t){if(t>0){const n=Nt(s);return Math.min(...n)>=t}return!0}function qe(s,t){return n=>{if(s[0]===s[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(s[1]-s[0]);return t[0]+r*(n-s[0])}}function St(s){return(String(s).split(".")[1]||"").length}function yt(s,t){const n=Math.pow(10,t);return Math.round(s*n)/n}var _t=ds,Et=fs,Ct=gs,kt=ps;function At({className:s,defaultValue:t,value:n,min:r=0,max:l=100,step:h=1,onValueChange:d,...a}){const m=o.useMemo(()=>Array.isArray(n)?n:Array.isArray(t)?t:[r],[n,t,r]);return e.jsxs(_t,{"data-slot":"slider",defaultValue:t,value:n,min:r,max:l,step:h,onValueChange:d,className:We("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50",s),...a,children:[e.jsx(Et,{"data-slot":"slider-track",className:"relative h-4 w-full grow overflow-hidden rounded-full bg-slate-200",children:e.jsx(Ct,{"data-slot":"slider-range",className:"absolute h-full bg-gradient-to-r from-blue-500 to-blue-600 transition-all"})}),Array.from({length:m.length},(u,x)=>e.jsx(kt,{"data-slot":"slider-thumb",className:"block size-5 shrink-0 rounded-full border-2 border-blue-600 bg-white shadow-lg transition-all hover:scale-110 hover:shadow-xl focus-visible:ring-4 focus-visible:ring-blue-300 focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 cursor-grab active:cursor-grabbing active:scale-95"},x))]})}function Rt({examId:s,attemptId:t,onBack:n,onComplete:r}){const{isLoading:l,fetchAttemptDetail:h,fetchQuestionByIndex:d}=Ze(),[a,m]=o.useState(null),[u,x]=o.useState(0),[c,f]=o.useState([]),[N,y]=o.useState([]),[w,v]=o.useState(!1),[_,q]=o.useState(!1),[P,A]=o.useState(null),[D,B]=o.useState(null),[O]=o.useState(Date.now()),[k,Z]=o.useState(!1),[L,$]=o.useState(!1),M=es(),K=o.useRef(new Set),G=o.useRef(-1),Q=o.useRef(null),[T,F]=o.useState(0),[b,E]=o.useState(.7),[R,C]=o.useState(!1),[z,ee]=o.useState(!1),[ne,se]=o.useState(null),V=o.useRef(null);o.useEffect(()=>{t?vs():Ie()},[s,t]);const vs=async()=>{try{A(null),$(!0);const i=await h(t),g={id:i.attempt.exam_id,title:i.attempt.exam_name,duration_minutes:i.attempt.duration_minutes,passing_score:i.attempt.passing_score,questions:i.questions,question_count:i.questions.length};m(g),q(!0);const p=i.questions.map(S=>({questionId:S.id,questionText:S.question_text,userAnswer:S.user_answer||"",userAnswerText:S.user_answer_text||"",isCorrect:S.is_correct,correctAnswer:S.correct_answer,correctAnswerText:S.correct_answer_text||"",explanation:S.explanation||""}));y(p)}catch(i){console.error("Erreur chargement tentative:",i),A("Impossible de charger la correction")}},Ie=async()=>{try{A(null),console.log("ðŸš€ Chargement progressif de l'examen",s);const i=await d(s,0);if(!i){A("Impossible de charger l'examen");return}const g={id:i.mock_exam.id,title:i.mock_exam.title,duration_minutes:i.mock_exam.duration_minutes,passing_score:i.mock_exam.passing_score,questions:[i.question],question_count:i.total_questions},p=new Map;p.set(0,i.question),m(g),g.duration_minutes&&B(g.duration_minutes*60),console.log("âœ… PremiÃ¨re question chargÃ©e, affichage de l'interface"),Ns(s,i.total_questions,g,p)}catch(i){console.error("Erreur chargement examen:",i),A("Impossible de charger l'examen")}},Ns=async(i,g,p,S)=>{console.log(`ðŸ”„ Chargement en arriÃ¨re-plan de ${g-1} questions...`);for(let j=1;j<g;j++){if(K.current.has(j)){console.log(`â­ï¸ Question ${j} dÃ©jÃ  en cours de chargement, skip`);continue}K.current.add(j);try{const X=await d(i,j);if(X&&X.question){S.set(j,X.question);const ae=Array.from({length:g},(te,Se)=>S.get(Se)||null).filter(Boolean);m(te=>te?{...te,questions:ae}:null),console.log(`âœ… Question ${j+1}/${g} chargÃ©e`)}}catch(X){console.error(`âŒ Erreur lors du chargement de la question ${j}:`,X)}finally{K.current.delete(j)}}console.log("âœ… Toutes les questions ont Ã©tÃ© chargÃ©es en arriÃ¨re-plan")};o.useEffect(()=>{if(L||D===null||D<=0||_)return;const i=setInterval(()=>{B(g=>g===null||g<=1?(_||ys(),0):g-1)},1e3);return()=>clearInterval(i)},[D,_,L]),o.useEffect(()=>{if(L||_)return;const i=a?.questions[u];if(!i){console.log(`â³ Question ${u} pas encore chargÃ©e, attente...`);return}if(G.current===u){console.log(`âœ… Question ${u} dÃ©jÃ  initialisÃ©e, skip audio`);return}if(console.log(`ðŸŽµ Initialisation audio pour question ${u}`),G.current=u,Q.current&&(Q.current.pause(),Q.current=null),V.current&&(clearInterval(V.current),V.current=null),F(0),se(null),C(!1),ee(!1),i.voice_url){const g=Ks.getAudioUrl(i.voice_url);if(!g)return;C(!0);const p=new Audio(g);Q.current=p,p.volume=b,p.addEventListener("loadedmetadata",()=>{C(!1),ee(!0)}),p.addEventListener("error",()=>{console.error("âŒ Erreur audio:",{audioUrl:g,voiceUrl:i?.voice_url,networkState:p.networkState,readyState:p.readyState,errorMessage:p.error?.message,errorCode:p.error?.code}),C(!1),ee(!1)}),p.addEventListener("timeupdate",()=>{F(p.currentTime/p.duration*100)}),p.addEventListener("ended",()=>{F(100),ee(!1),se(20);let S=20;V.current=setInterval(()=>{if(S--,se(S),S<=0){V.current&&(clearInterval(V.current),V.current=null);const j=document.querySelector('[data-next-button="true"]');j&&j.click()}},1e3)}),p.play().catch(S=>{console.error("Erreur lecture audio:",S)})}return()=>{Q.current&&(Q.current.pause(),Q.current=null),V.current&&(clearInterval(V.current),V.current=null)}},[u,L,_,a?.questions[u]]),o.useEffect(()=>{Q.current&&(Q.current.volume=b,console.log(`ðŸ”Š Volume mis Ã  jour: ${Math.round(b*100)}%`))},[b]),o.useEffect(()=>{Q.current&&(Q.current.volume=b)},[b]);const ws=i=>{const g=Math.floor(i/60),p=i%60;return`${g}:${p.toString().padStart(2,"0")}`},$e=(i,g)=>!g||!i?"":g.split(",").map(j=>j.trim()).map(j=>{switch(j){case"A":return i.option_a;case"B":return i.option_b;case"C":return i.option_c;case"D":return i.option_d;default:return null}}).filter(Boolean).join(", "),Ss=i=>{f(g=>g.includes(i)?g.filter(p=>p!==i):[...g,i].sort())},Qe=i=>{const g=a?.questions?.[u];g&&(g.question_type==="true_false"?f([i]):Ss(i))},ys=async()=>{q(!0);try{const i=Math.floor((Date.now()-O)/1e3),g=Math.round(i/60),p=N.filter(j=>j.isCorrect).length,S={};N.forEach(j=>{S[j.questionId]=j.userAnswer}),console.log("ðŸ”¥ handleAutoSubmit - Envoi:",{mock_exam_id:s,score:p,time_spent_minutes:g,answers:S}),await fe.submitExamResult({mock_exam_id:s,score:p,time_spent_minutes:g,answers:S})}catch(i){console.error("âš ï¸ Erreur sauvegarde rÃ©sultat (non bloquant):",i),console.error("RÃ©ponse API:",i.response?.data)}},_s=async()=>{if(!a)return;V.current&&(clearInterval(V.current),V.current=null,se(null));const i=a.questions?.[u];if(i){v(!0);try{const g=c.join(","),p=await ie.validate(i.id,g),S=$e(i,g),j=$e(i,p.correctAnswer||g),X={questionId:i.id,questionText:i.question_text,userAnswer:g,userAnswerText:S,isCorrect:p.isCorrect,correctAnswer:p.correctAnswer||g,correctAnswerText:j,explanation:p.explanation||""},ae=[...N,X];if(y(ae),u<(a.questions?.length||0)-1)x(u+1),f([]);else{q(!0);try{const te=a.duration_minutes?a.duration_minutes*60-(D||0):Math.floor((Date.now()-O)/1e3),Se=Math.round(te/60),As=ae.filter(pe=>pe.isCorrect).length,Fe={};ae.forEach(pe=>{Fe[pe.questionId]=pe.userAnswer});const ze={mock_exam_id:s,score:As,time_spent_minutes:Se,answers:Fe};console.log("ðŸ”¥ handleNext - Envoi:",ze),await fe.submitExamResult(ze)}catch(te){console.error("âš ï¸ Erreur sauvegarde rÃ©sultat (non bloquant):",te),console.error("RÃ©ponse API:",te.response?.data)}}}catch(g){console.error("âŒ Erreur validation rÃ©ponse:",g),A(g.response?.data?.message||"Erreur lors de la validation de la rÃ©ponse")}finally{v(!1)}}},Es=()=>{L?($(!1),q(!1),x(0),f([]),y([]),A(null),Ie()):(x(0),f([]),y([]),q(!1),A(null),a?.duration_minutes&&B(a.duration_minutes*60))},Cs=async()=>{Z(!0);try{await r(),n()}catch(i){console.error("Erreur lors de la finalisation:",i),Z(!1)}};if(l||!a)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Chargement de l'examen..."})]})})})});if(P)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(U,{variant:"outline",onClick:n,className:"mb-6",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs(ye,{className:"bg-red-50 border-red-200",children:[e.jsx(xe,{className:"w-5 h-5 text-red-600"}),e.jsx(_e,{className:"text-red-800",children:P})]})]})});if(_){const i=a?.questions?.length||0,g=N.filter(j=>j.isCorrect).length,p=Math.round(g/i*100),S=g>=(a?.passing_score||0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4",children:e.jsx("div",{className:"max-w-3xl mx-auto py-6",children:e.jsxs(H,{className:"border-2 border-slate-200",children:[e.jsxs(J,{className:"text-center pb-4",children:[e.jsx("div",{className:`w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center ${S?"bg-green-100":"bg-orange-100"}`,children:S?e.jsx(Xe,{className:"w-10 h-10 text-green-600"}):e.jsx(xe,{className:"w-10 h-10 text-orange-600"})}),e.jsx(Y,{className:"text-2xl",children:S?"FÃ©licitations !":"Examen terminÃ©"}),e.jsx("p",{className:"text-slate-600 mt-2",children:a?.title})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-5xl font-bold text-slate-800 mb-2",children:[p,"%"]}),e.jsxs("p",{className:"text-slate-600",children:[g," bonnes rÃ©ponses sur ",i]}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Score minimum requis : ",a?.passing_score," / ",i]})]}),e.jsx(Ae,{value:p,className:"h-3 mb-6"}),e.jsx("div",{className:"space-y-3 mb-6",children:N.map(j=>e.jsx(H,{className:`border ${j.isCorrect?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[j.isCorrect?e.jsx(Ee,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(Ye,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:j.questionText}),e.jsxs("p",{className:"text-xs text-slate-600 mb-2",children:["Votre rÃ©ponse : ",e.jsxs("span",{className:"font-semibold",children:[j.userAnswer," "]}),j.userAnswerText&&e.jsxs("span",{className:"ml-1 text-slate-500",children:["(",j.userAnswerText,")"]}),!j.isCorrect&&j.correctAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"Bonne rÃ©ponse : ",e.jsxs("span",{className:"font-semibold text-green-700",children:[j.correctAnswer," "]}),j.correctAnswerText&&e.jsxs("span",{className:"ml-1 text-green-600",children:["(",j.correctAnswerText,")"]})]}),j.isCorrect&&j.correctAnswerText&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{className:"text-green-600",children:["âœ“ ",j.correctAnswerText]})]})]}),j.isCorrect&&j.correctAnswer.includes(",")&&e.jsx("p",{className:"text-xs text-green-600 mb-2",children:"âœ… Toutes les bonnes rÃ©ponses trouvÃ©es !"}),j.explanation&&e.jsxs("p",{className:"text-xs text-slate-500 italic bg-blue-50 p-2 rounded border border-blue-200",children:["ðŸ’¡ ",j.explanation]})]})]})})},j.questionId))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(U,{onClick:Es,variant:"outline",className:"flex-1",disabled:k,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),L?"RÃ©essayer":"Recommencer"]}),e.jsx(U,{onClick:Cs,className:"flex-1",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Chargement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Retour"]})})]})]})]})})})}const I=a.questions?.[u],me=a.questions?.length||0,ks=me>0?u/me*100:0,Le=I?I.question_type==="true_false"?[{key:"A",value:I.option_a||"Vrai"},{key:"B",value:I.option_b||"Faux"}]:[{key:"A",value:I.option_a},{key:"B",value:I.option_b},{key:"C",value:I.option_c},{key:"D",value:I.option_d}].filter(g=>g.value):[];return e.jsx("div",{className:`min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 ${M?"p-4":"p-8"}`,children:e.jsxs("div",{className:`mx-auto py-6 ${M?"max-w-3xl":"max-w-[80vw]"}`,children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs(U,{variant:"outline",onClick:n,size:M?"sm":"lg",children:[e.jsx(re,{className:`${M?"w-4 h-4":"w-6 h-6"} mr-2`}),"Retour"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(be,{variant:"outline",className:M?"text-sm":"text-lg px-4 py-2",children:["Question ",u+1," / ",me]}),D!==null&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg font-semibold ${M?"text-sm":"text-lg"} ${D<300?"bg-red-100 text-red-700 animate-pulse":"bg-blue-100 text-blue-700"}`,children:[e.jsx(Je,{className:M?"w-4 h-4":"w-6 h-6"}),ws(D)]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(Ae,{value:ks,className:M?"h-2":"h-4"}),e.jsxs("div",{className:`flex justify-between items-center mt-2 ${M?"text-xs":"text-base"} text-slate-600`,children:[e.jsx("span",{children:a?.title}),e.jsxs("span",{children:["Score minimum : ",a?.passing_score,"/",me]})]})]}),D!==null&&D<60&&!_&&e.jsxs(ye,{className:"mb-4 bg-red-50 border-red-200",children:[e.jsx(xe,{className:"w-4 h-4 text-red-600"}),e.jsx(_e,{className:"text-red-800 text-sm",children:"â° Moins d'une minute restante !"})]}),P&&e.jsxs(ye,{className:"mb-4 bg-red-50 border-red-200",children:[e.jsx(xe,{className:"w-4 h-4 text-red-600"}),e.jsx(_e,{className:"text-red-800",children:P})]}),!I&&!L&&a&&e.jsx(H,{className:"border-2 border-slate-200 mb-4",children:e.jsx(W,{className:"p-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(oe,{className:"w-12 h-12 animate-spin text-blue-600 mb-4"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Chargement de la question..."}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Veuillez patienter"})]})})}),I&&e.jsxs(H,{className:`border-2 border-slate-200 ${M?"":"p-4"}`,children:[e.jsx(J,{children:(()=>{const i=ve(I.question_text);return Ne(I.question_text)&&i.subQuestions.length>0?e.jsx(Y,{className:M?"text-lg":"text-2xl",children:i.mainText}):e.jsx(Y,{className:M?"text-lg":"text-2xl",children:I.question_text})})()}),e.jsxs(W,{children:[I.image_url&&e.jsx("div",{className:"mb-6 space-y-4",children:I.image_url.split(";").filter(i=>i.trim()).map((i,g)=>{const p=i.trim();let S=p;return!p.startsWith("http://")&&!p.startsWith("https://")&&(S=`/app-bateau-client/${p}`),e.jsx("div",{children:e.jsx("img",{src:S,alt:`Image de la question ${g+1}`,className:"w-full h-auto max-h-96 object-contain rounded-lg border border-slate-200",onError:j=>{console.error("Erreur chargement image:",S),j.target.style.display="none"}})},g)})}),I.voice_url&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg border-2 border-slate-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-600",children:[e.jsx("div",{className:"flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 text-blue-500 animate-spin"}),e.jsx("span",{className:"font-medium",children:"Chargement de l'audio..."})]}):z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Lecture audio en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"}),e.jsx("span",{className:"font-medium",children:"En attente..."})]})}),e.jsxs("span",{className:"font-semibold",children:[Math.round(T),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-300 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 h-full transition-all duration-300 ease-out relative",style:{width:`${T}%`},children:e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})})})]}),!M&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsx(qs,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsx("div",{className:"flex-1 px-2",children:e.jsx(At,{value:[b*100],onValueChange:i=>E(i[0]/100),min:0,max:100,step:1,className:"w-full",disabled:R})}),e.jsxs("span",{className:"text-sm font-bold text-blue-700 w-12 text-right",children:[Math.round(b*100),"%"]}),ne!==null&&e.jsxs(be,{variant:"destructive",className:"ml-2 animate-pulse font-bold",children:["â±ï¸ ",ne,"s"]})]}),M&&ne!==null&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(be,{variant:"destructive",className:"animate-pulse font-bold",children:["â±ï¸ Prochaine question dans ",ne,"s"]})})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[I.question_type==="true_false"&&e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"SÃ©lectionnez une rÃ©ponse"}),I.question_type==="multiple_choice"&&e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:I.correct_answer?.includes(",")?"âš ï¸ Plusieurs rÃ©ponses possibles - Cochez toutes les bonnes rÃ©ponses":"SÃ©lectionnez une ou plusieurs rÃ©ponses"}),(()=>{const i=ve(I.question_text);return!Ne(I.question_text)||i.subQuestions.length===0?Le.map(p=>{const S=c.includes(p.key),j=I.question_type==="true_false";return e.jsx("div",{onClick:()=>!w&&Qe(p.key),className:`w-full p-4 text-left rounded-lg border-2 transition-all ${S?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300 bg-white"} ${w?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[j?e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${S?"border-blue-500 bg-blue-500":"border-slate-300"}`,children:S&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}):e.jsx(ke,{checked:S,className:"pointer-events-none"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[p.key,"."]}),e.jsx("span",{className:"ml-2 text-slate-700",children:p.value})]})]})},p.key)}):e.jsx(e.Fragment,{children:Le.map(p=>{const S=c.includes(p.key),j=I.question_type==="true_false",X=as(i,p.key),ae=X&&X.options[0]===p.key;return e.jsxs("div",{children:[ae&&e.jsx("div",{className:"mb-3 mt-6 first:mt-0",children:e.jsxs("h4",{className:`font-semibold text-slate-700 ${M?"text-base":"text-lg"}`,children:[X.text," :"]})}),e.jsx("div",{onClick:()=>!w&&Qe(p.key),className:`w-full p-4 text-left rounded-lg border-2 transition-all ${S?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300 bg-white"} ${w?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[j?e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${S?"border-blue-500 bg-blue-500":"border-slate-300"}`,children:S&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}):e.jsx(ke,{checked:S,className:"pointer-events-none"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[p.key,"."]}),e.jsx("span",{className:"ml-2 text-slate-700",children:p.value})]})]})})]},p.key)})})})()]}),e.jsx(U,{onClick:_s,disabled:w,"data-next-button":"true",className:"w-full",children:w?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Validation..."]}):u<me-1?"Question suivante":"Terminer l'examen"})]})]})]})})}function Pt({onBack:s}){const{profile:t,userDetails:n,isLoading:r,error:l}=et(),{isDarkMode:h,toggleDarkMode:d}=Us();if(console.log("StudentProfile - isLoading:",r),console.log("StudentProfile - error:",l),console.log("StudentProfile - profile:",t),console.log("StudentProfile - userDetails:",n),r)return e.jsxs("div",{className:"profile-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement du profil..."})]});if(l||!t||!n)return e.jsxs("div",{className:"profile-error",children:[e.jsx("div",{className:"error-icon",children:"âŒ"}),e.jsx("h2",{children:"Erreur de chargement"}),e.jsx("p",{children:l||"Impossible de charger votre profil"}),e.jsxs("p",{style:{fontSize:"12px",marginTop:"10px"},children:["Debug: profile=",t?"OK":"NULL",", userDetails=",n?"OK":"NULL"]}),e.jsx("button",{onClick:s,className:"back-button",children:"Retour"})]});const{user:a,themeProgress:m,mockExamStats:u}=t,x=m.length>0?Math.round(m.reduce((v,_)=>{let q=0;return _.progress_percentage!==null&&(q=typeof _.progress_percentage=="string"?parseFloat(_.progress_percentage):_.progress_percentage),v+q},0)/m.length):0,c=m.filter(v=>v.completed_questions>0).length,f=typeof u.average_score=="string"?parseFloat(u.average_score):u.average_score,N=v=>new Date(v).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),w=a.is_active?a.days_remaining<=7?{text:"Expire bientÃ´t",color:"orange"}:{text:"Compte actif",color:"green"}:{text:"Compte inactif",color:"red"};return e.jsxs("div",{className:"student-profile",children:[e.jsxs("div",{className:"profile-header",children:[e.jsx("button",{onClick:s,className:"back-button",children:e.jsx(re,{size:24})}),e.jsx("h1",{className:"profile-title",children:"Mon Profil"})]}),e.jsxs(H,{className:"profile-card",children:[e.jsx(J,{children:e.jsxs(Y,{className:"card-title-with-icon",children:[e.jsx(Is,{size:20}),"Informations du compte"]})}),e.jsxs(W,{className:"profile-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Nom complet"}),e.jsx("span",{className:"info-value",children:a.name})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Email"}),e.jsx("span",{className:"info-value",children:a.email})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Date d'activation"}),e.jsx("span",{className:"info-value",children:N(n.activation_start_date)})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Date d'expiration"}),e.jsx("span",{className:"info-value",children:N(n.activation_end_date)})]}),e.jsxs("div",{className:"info-row highlight",children:[e.jsx("span",{className:"info-label",children:"Jours restants"}),e.jsxs("span",{className:`info-value days-remaining ${w.color}`,children:[a.days_remaining," jours"]})]}),e.jsx("div",{className:"account-status",style:{borderLeftColor:w.color},children:e.jsx("span",{className:`status-badge ${w.color}`,children:w.text})}),e.jsxs("div",{className:"info-row theme-toggle-row",children:[e.jsx("span",{className:"info-label",children:"Mode sombre"}),e.jsxs("button",{onClick:d,className:"theme-toggle-button","aria-label":h?"Passer en mode clair":"Passer en mode sombre",children:[h?e.jsx($s,{size:20}):e.jsx(Qs,{size:20}),e.jsx("span",{children:h?"Mode clair":"Mode sombre"})]})]})]})]}),e.jsxs(H,{className:"profile-card",children:[e.jsx(J,{children:e.jsxs(Y,{className:"card-title-with-icon",children:[e.jsx(Ls,{size:20}),"Progression globale"]})}),e.jsxs(W,{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-label",children:"ThÃ¨mes commencÃ©s"}),e.jsxs("span",{className:"stat-value",children:[c," / ",m.length]})]})]}),e.jsxs("div",{className:"progress-bar-container",children:[e.jsxs("div",{className:"progress-bar-header",children:[e.jsx("span",{className:"progress-label",children:"Progression globale"}),e.jsxs("span",{className:"progress-percentage",children:[x,"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${x}%`}})})]})]})]}),e.jsxs(H,{className:"profile-card",children:[e.jsx(J,{children:e.jsxs(Y,{className:"card-title-with-icon",children:[e.jsx(Je,{size:20}),"Examens blancs"]})}),e.jsxs(W,{className:"exam-stats",children:[e.jsxs("div",{className:"exam-stat-row",children:[e.jsx("span",{className:"exam-label",children:"Examens passÃ©s"}),e.jsx("span",{className:"exam-value",children:u.total_attempts})]}),e.jsxs("div",{className:"exam-stat-row highlight",children:[e.jsx("span",{className:"exam-label",children:"Meilleure note"}),e.jsx("span",{className:"exam-value best-score",children:u.best_score>0?`${u.best_score}/40`:"Aucun"})]}),e.jsxs("div",{className:"exam-stat-row highlight",children:[e.jsx("span",{className:"exam-label",children:"Moyenne des 5 derniers"}),e.jsx("span",{className:"exam-value average-score",children:f>0?`${f.toFixed(1)}/40`:"Aucun"})]})]})]}),e.jsxs(H,{className:"profile-card",children:[e.jsx(J,{children:e.jsxs(Y,{className:"card-title-with-icon",children:[e.jsx(Ve,{size:20}),"Statistiques par thÃ¨me"]})}),e.jsx(W,{className:"theme-stats-list",children:m.length>0?m.map(v=>{const _=v.completed_questions||0,q=v.total_questions||1,P=typeof v.progress_percentage=="string"?parseFloat(v.progress_percentage):v.progress_percentage||0,A=typeof v.score=="string"?parseFloat(v.score):v.score||0,D=_>0?Math.round(A):0;return e.jsxs("div",{className:"theme-stat-item",children:[e.jsxs("div",{className:"theme-stat-header",children:[e.jsx("h4",{className:"theme-stat-title",children:v.theme_name}),e.jsxs("span",{className:"theme-stat-badge",children:[Math.round(P),"%"]})]}),e.jsxs("div",{className:"theme-stat-details",children:[e.jsxs("div",{className:"theme-stat-row",children:[e.jsx("span",{className:"theme-stat-label",children:"Questions rÃ©pondues"}),e.jsxs("span",{className:"theme-stat-value",children:[_," / ",q]})]}),e.jsxs("div",{className:"theme-stat-row",children:[e.jsx("span",{className:"theme-stat-label",children:"Taux de rÃ©ussite"}),e.jsxs("span",{className:`theme-stat-value ${D>=70?"success":D>=50?"warning":"danger"}`,children:[D,"%"]})]})]}),e.jsx("div",{className:"theme-progress-bar",children:e.jsx("div",{className:"theme-progress-fill",style:{width:`${P}%`}})})]},v.theme_id)}):e.jsx("p",{className:"no-data",children:"Aucune progression pour le moment"})})]})]})}const Tt=({title:s,icon:t,imageUrl:n,onClick:r,className:l="",progress:h=0})=>{const a=t?(m=>{if(!m)return null;const u=Fs[m];return u?e.jsx(u,{size:40,strokeWidth:1.5}):null})(t):null;return e.jsxs("div",{className:`theme-card ${l}`,onClick:r,children:[e.jsx("div",{className:"theme-card-icon-container",children:n?e.jsx("img",{src:n,alt:s,className:"theme-card-image"}):a?e.jsx("div",{className:"theme-card-lucide-icon",children:a}):e.jsx("span",{className:"theme-card-icon",children:"ðŸ“š"})}),e.jsx("div",{className:"theme-card-title",children:s}),h>0&&e.jsxs("div",{className:"theme-card-progress",children:[e.jsx("div",{className:"theme-progress-track",children:e.jsx("div",{className:"theme-progress-filled",style:{width:`${h}%`}})}),e.jsxs("span",{className:"theme-progress-label",children:[h,"%"]})]})]})};function Qt({user:s,onLogout:t}){const[n,r]=o.useState("dashboard"),[l,h]=o.useState(null),[d,a]=o.useState(null),[m,u]=o.useState(null),x=es(),{themes:c,isLoading:f,error:N,refresh:y}=Hs(!0),{nextExam:w,examHistory:v,isLoading:_,error:q,fetchNextExam:P,fetchExamHistory:A}=Ze(),{isLoading:D,error:B,refresh:O,fetchStats:k}=Zs();o.useEffect(()=>{P(),A()},[]);const Z=T=>{h(T),r("quiz")},L=T=>{a(T),u(null),r("mockExam")},$=(T,F)=>{a(F),u(T),r("mockExam")},M=()=>{w&&L(w.id)},K=async()=>{n==="quiz"?(r("dashboard"),h(null),console.log("ðŸ”„ Retour au dashboard - Rechargement des donnÃ©es..."),await Promise.all([y(),O(),k(),P(),A()]),console.log("âœ… DonnÃ©es rechargÃ©es")):n==="mockExam"?(r("dashboard"),a(null),console.log("ðŸ”„ Retour au dashboard - Rechargement des donnÃ©es..."),await Promise.all([y(),O(),k(),P(),A()]),console.log("âœ… DonnÃ©es rechargÃ©es")):n==="profile"&&r("dashboard")},G=async()=>{console.log("ðŸ”„ Rechargement de la progression et des thÃ¨mes..."),await Promise.all([y(),O(),k(),P(),A()]),console.log("âœ… Rechargement terminÃ©")};if(n==="quiz"&&l)return e.jsx(ct,{theme:l,onBack:K,onComplete:G});if(n==="mockExam"&&d)return e.jsx(Rt,{examId:d,attemptId:m,onBack:K,onComplete:G});if(n==="profile")return e.jsx(Pt,{onBack:K});if(f||_||D)return e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des donnÃ©es..."})]});if(N||q||B)return e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"âŒ"}),e.jsx("h2",{children:"Erreur de chargement"}),e.jsx("p",{children:N||q||B||"Une erreur est survenue."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-button",children:"Recharger la page"})]});const Q=s.name||s.email.split("@")[0];return e.jsxs("div",{className:`student-dashboard ${x?"":"desktop-mode"}`,children:[e.jsxs("div",{className:`dashboard-header ${x?"":"desktop-header"}`,children:[e.jsx("img",{className:`dashboard-logo ${x?"":"desktop-logo"}`,alt:"Logo LibertyLoc",src:"/logo-liberty-loc-1-1.png"}),e.jsxs("h1",{className:`dashboard-greeting ${x?"":"desktop-greeting"}`,children:["Salut ",Q]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!x&&e.jsxs("button",{className:"desktop-profile-button",onClick:()=>r("profile"),title:"Mon Profil",children:[e.jsx(Be,{size:28,color:"#006DB5"}),e.jsx("span",{children:"Mon Profil"})]}),e.jsx("button",{className:`logout-button ${x?"":"desktop-logout"}`,onClick:t,title:"Se dÃ©connecter",children:e.jsx(zs,{size:x?24:32,color:"#F5F5F5"})})]})]}),e.jsxs("div",{className:`exercises-section ${x?"":"desktop-section"}`,children:[e.jsx("h2",{className:`section-title ${x?"":"desktop-title"}`,children:"Exercices"}),e.jsx("div",{className:`themes-grid ${x?"":"desktop-grid"}`,children:Array.isArray(c)&&c.map(T=>{const F=T.progress_percentage||0;return e.jsx(Tt,{title:T.title,imageUrl:T.icon,onClick:()=>Z(T),progress:F},T.id)})})]}),e.jsxs("div",{className:`mock-exams-section ${x?"":"desktop-section"}`,children:[e.jsx("h2",{className:`section-title ${x?"":"desktop-title"}`,children:"Examens blanc"}),w&&e.jsx("button",{className:`launch-exam-button ${x?"":"desktop-launch-button"}`,onClick:M,children:"Lancer un examen blanc"}),v&&v.length>0&&e.jsxs("div",{className:`exam-history ${x?"":"desktop-history"}`,children:[e.jsx("h3",{className:`history-title ${x?"":"desktop-subtitle"}`,children:"Historique des tentatives"}),e.jsx("div",{className:`exams-list ${x?"":"desktop-exams-list"}`,children:v.map(T=>e.jsxs("div",{className:"exam-card",onClick:()=>$(T.attempt_id,T.exam_id),children:[e.jsx("div",{className:"exam-title",children:T.exam_name}),e.jsx("div",{className:"exam-info",children:new Date(T.completed_at).toLocaleDateString("fr-FR")}),e.jsxs("div",{className:"exam-score",children:["Score : ",e.jsxs("strong",{children:[T.score,"/40"]}),T.passed?" âœ…":" âŒ"]})]},T.attempt_id))})]})]}),e.jsxs("div",{className:"bottom-navigation",children:[e.jsx("button",{className:`nav-button ${n==="dashboard"?"active":""}`,children:e.jsx(Vs,{size:24})}),e.jsx("button",{onClick:()=>r("profile"),children:e.jsx(Be,{size:24})})]})]})}export{Qt as StudentDashboard};
